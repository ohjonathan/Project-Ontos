---
id: v2_4_config_automation_proposal
type: strategy
status: draft
depends_on: [v2_strategy, mission]
---

# Ontos v2.4 Proposal: Configuration Automation & UX Overhaul

**Authors:** Jonathan Oh, Claude Code
**Date:** 2025-12-14
**Status:** Draft - Pending Architectural Review
**Reviewers:** Claude, Codex, Gemini

---

## Executive Summary

This document proposes a significant UX improvement to Ontos configuration. The goal is to reduce friction for new users while preserving power-user flexibility. We propose a **two-tier configuration system** with high-level "modes" and low-level individual settings.

---

## 1. Problem Statement

### 1.1 Current Pain Points

1. **Configuration is fragmented and technical**
   - Users must understand 10+ individual settings
   - No clear guidance on which settings work well together
   - Default values assume "strict team mode" which frustrates solo devs

2. **Maintenance rituals are forgotten**
   - `Consolidate Ontos` is documented but rarely executed
   - No enforcement or automation for log cleanup
   - Active logs grow unbounded in most projects

3. **Installation doesn't capture user intent**
   - `ontos_init.py` creates config but doesn't ask preferences
   - Users must manually edit `ontos_config.py` to customize
   - No guided setup for different use cases (solo vs team, strict vs relaxed)

4. **Archiving ceremony creates friction**
   - Pre-push hook blocks until manual archive
   - Users resort to `--no-verify` to bypass
   - Context is lost when ceremony is skipped

### 1.2 User Feedback Signals

- PR reviews show `--no-verify` usage when blocked
- `ontos_consolidate.py` exists but consolidation rarely happens
- New users confused by strict defaults during prototyping

---

## 2. Design Journey

### 2.1 Initial Observation

Started with root directory cleanup (moving planning docs to archive). During `Maintain Ontos`, discovered untagged files in archive - led to fixing `ontos_migrate_frontmatter.py` to skip archive directories.

### 2.2 Consolidation Automation

**Question:** "Realistically, what's the chance that people will actually remember to consolidate?"

**Answer:** Very low. No enforcement, no immediate pain, so it doesn't happen.

**Decision:** Integrate consolidation into `Maintain Ontos` with a config option:
- `AUTO_CONSOLIDATE = True` → auto-archive logs >30 days
- `AUTO_CONSOLIDATE = False` → show reminder only

### 2.3 Installation-Time Choice

**Question:** "When installing, shouldn't we ask users what level of automation they want?"

**Decision:** Yes. Add installation prompt for consolidation preference.

### 2.4 Expanding the Config Review

**Question:** "What other config options exist? What else should users customize?"

**Discovery:** 10+ config options exist, but only `AUTO_CONSOLIDATE` was prompted during install.

### 2.5 Rethinking from User Perspective

**Reframe:** Don't ask "what options exist?" Ask "what decisions matter to users at install time?"

**Insight:** Users think in terms of:
1. "How strict should this be?" (workflow style)
2. "How much work is this?" (maintenance overhead)
3. "Who am I?" (attribution)

### 2.6 The Automation Spectrum

**Proposal:** Offer a spectrum from "do it for me" to "I'll handle it":

| Mode | Description | Friction Level |
|------|-------------|----------------|
| **Automated** | Archive on push, auto-consolidate, silent | Zero |
| **Prompted** | Block until archived, manual control | Medium |
| **Advisory** | Reminders only, no blocking | Low (but risky) |

### 2.7 Two-Tier Configuration

**Final Design:**
- **Tier 1 (High-level):** Choose a mode - sets sensible defaults
- **Tier 2 (Low-level):** Override individual settings if needed

This mirrors patterns in other tools (e.g., ESLint presets, IDE profiles).

---

## 3. Proposed Architecture

### 3.1 Configuration File Structure

```python
"""Ontos Configuration.

Edit ONTOS_MODE for quick setup, or customize individual settings below.
Run `python3 ontos_init.py --reconfig` to change via prompts.
"""

# =============================================================================
# QUICK SETUP: Choose your mode
# =============================================================================
# "automated" - Zero friction, archives on push, auto-consolidates
# "prompted"  - Blocked until archived, you control details
# "advisory"  - Reminders only, maximum flexibility
#
# This sets sensible defaults. Override individual settings below if needed.

ONTOS_MODE = "automated"

# Your name for log attribution
DEFAULT_SOURCE = "Claude Code"

# =============================================================================
# ADVANCED: Individual settings (override mode defaults)
# =============================================================================
# Uncomment to customize. These override ONTOS_MODE defaults.

# --- Archiving Behavior ---
# AUTO_ARCHIVE_ON_PUSH = True        # Auto-create log on push (automated mode)
# ENFORCE_ARCHIVE_BEFORE_PUSH = True # Block push until archived (prompted mode)
# REQUIRE_SOURCE_IN_LOGS = True      # Require --source flag

# --- Consolidation ---
# AUTO_CONSOLIDATE = True            # Auto-archive old logs in Maintain
# CONSOLIDATION_THRESHOLD_DAYS = 30  # Age threshold for consolidation

# --- Validation ---
# SMALL_CHANGE_THRESHOLD = 20        # Lines below this = "small change"
# LOG_RETENTION_COUNT = 15           # Warn when logs exceed this
```

### 3.2 Mode Presets

| Setting | `automated` | `prompted` | `advisory` |
|---------|-------------|------------|------------|
| `AUTO_ARCHIVE_ON_PUSH` | True | False | False |
| `ENFORCE_ARCHIVE_BEFORE_PUSH` | False | True | False |
| `REQUIRE_SOURCE_IN_LOGS` | False | True | False |
| `AUTO_CONSOLIDATE` | True | True | False |

### 3.3 Installation Flow

```
Welcome to Project Ontos Setup
==============================

1. How should Ontos handle session archiving?

   [1] Fully Automatic (recommended)
       - Auto-archives session on git push
       - Uses branch name as slug, your name as source
       - Zero friction, best practices enforced silently

   [2] Prompted (balanced)
       - Push blocked until you archive
       - You choose event type, slug, and details
       - More control, some ceremony

   [3] Advisory (minimal)
       - Push shows reminder only
       - You decide if/when to archive
       - Maximum flexibility, risk of forgetting

2. How should old logs be handled?

   [1] Auto (recommended) - Maintain Ontos archives logs >30 days
   [2] Manual - You decide when to consolidate

3. What name should appear in logs?

   Enter name (or blank to prompt each time): _________

──────────────────────────────────────────────────────
Configuration saved to ontos_config.py
You can change these settings anytime by editing the file
or running: python3 ontos_init.py --reconfig
──────────────────────────────────────────────────────
```

### 3.4 Setting Resolution Logic

Scripts resolve settings in this order:
1. Check if individual setting is explicitly set in `ontos_config.py`
2. If not, check `ONTOS_MODE` and use preset value
3. If no mode, use defaults from `ontos_config_defaults.py`

```python
def get_config_value(setting_name):
    # 1. Explicit override?
    if hasattr(config, setting_name):
        return getattr(config, setting_name)

    # 2. Mode-based preset?
    if hasattr(config, 'ONTOS_MODE'):
        return MODE_PRESETS[config.ONTOS_MODE].get(setting_name)

    # 3. Fall back to defaults
    return getattr(defaults, setting_name)
```

---

## 4. New Feature: Auto-Archive on Push

### 4.1 Behavior

When `AUTO_ARCHIVE_ON_PUSH = True`:
1. Pre-push hook intercepts push
2. Checks if session marker exists (already archived) → allow push
3. If not, automatically runs `ontos_end_session.py --auto`
   - Slug: derived from branch name
   - Event type: inferred from branch prefix (`feat/` → feature, `fix/` → fix) or defaults to `chore`
   - Source: from `DEFAULT_SOURCE`
   - Concepts: empty (can be filled later)
   - Impacts: auto-suggested from git diff
4. Creates log silently
5. Allows push to proceed

### 4.2 Implementation Requirements

1. **New flag:** `ontos_end_session.py --auto`
   - Non-interactive mode
   - Auto-generates all fields
   - No prompts, no blocking

2. **Hook modification:** `ontos_pre_push_check.py`
   - Check `AUTO_ARCHIVE_ON_PUSH` config
   - If true, run auto-archive instead of blocking

3. **Branch prefix parsing:**
   ```python
   def infer_event_type(branch_name):
       prefixes = {
           'feat/': 'feature',
           'feature/': 'feature',
           'fix/': 'fix',
           'bugfix/': 'fix',
           'refactor/': 'refactor',
           'chore/': 'chore',
           'docs/': 'chore',
           'explore/': 'exploration',
       }
       for prefix, event_type in prefixes.items():
           if branch_name.startswith(prefix):
               return event_type
       return 'chore'  # default
   ```

---

## 5. Migration Path

### 5.1 Existing Users

- `ontos_config.py` continues to work as-is
- No `ONTOS_MODE` → individual settings respected
- Running `ontos_init.py --reconfig` offers migration to new system

### 5.2 New Users

- Installation prompts for mode selection
- Config file generated with `ONTOS_MODE` set
- Individual settings commented out (using mode defaults)

### 5.3 Backward Compatibility

All existing settings remain valid. The mode system is purely additive.

---

## 6. Implementation Scope

### 6.1 Files to Modify

| File | Changes |
|------|---------|
| `ontos_config_defaults.py` | Add `ONTOS_MODE`, `AUTO_ARCHIVE_ON_PUSH`, `MODE_PRESETS` |
| `ontos_init.py` | New installation prompts, `--reconfig` flag |
| `ontos_end_session.py` | New `--auto` flag for non-interactive mode |
| `ontos_pre_push_check.py` | Auto-archive logic when `AUTO_ARCHIVE_ON_PUSH=True` |
| `ontos_config.py` (template) | Two-tier structure with documentation |

### 6.2 New Files

| File | Purpose |
|------|---------|
| `ontos_config_resolver.py` | Centralized config resolution logic |

### 6.3 Tests to Add

- Mode preset resolution
- Auto-archive on push (mock git operations)
- Branch prefix → event type inference
- Config migration scenarios

---

## 7. Open Questions for Review

### 7.1 Mode Naming

Current: `automated`, `prompted`, `advisory`

Alternatives considered:
- `auto`, `standard`, `relaxed`
- `frictionless`, `balanced`, `flexible`
- `team`, `solo`, `minimal`

**Question:** Are the current names clear enough?

### 7.2 Default Mode

**Question:** Should the default for new installs be:
- `automated` (zero friction, might surprise users)
- `prompted` (current behavior, expected for teams)

### 7.3 Auto-Archive Quality

When auto-archiving:
- Slug is auto-generated ✓
- Source is from config ✓
- Event type is inferred ✓
- **Concepts:** Empty (acceptable?)
- **Impacts:** Auto-suggested (acceptable?)
- **Goal section:** Template placeholder (acceptable?)

**Question:** Is a minimal auto-generated log better than no log at all?

### 7.4 Reconfig UX

**Question:** Should `ontos_init.py --reconfig`:
- Overwrite `ontos_config.py` completely?
- Merge with existing settings?
- Create backup before modifying?

### 7.5 Consolidation in Advisory Mode

Current proposal: `advisory` mode sets `AUTO_CONSOLIDATE = False`

**Question:** Should advisory mode still auto-consolidate? The user chose "minimal friction" but consolidation is invisible maintenance.

---

## 8. Success Metrics

If implemented successfully:

1. **Reduced `--no-verify` usage** - Users don't need to bypass hooks
2. **Higher consolidation rate** - Logs actually get archived
3. **Faster onboarding** - New users productive in <2 minutes
4. **Fewer config questions** - Mode selection covers 90% of needs

---

## 9. Risks & Mitigations

| Risk | Mitigation |
|------|------------|
| Auto-archive creates low-quality logs | Accept minimal logs > no logs; users can enhance later |
| Mode abstraction confuses power users | Individual settings still work; mode is optional |
| Breaking change for existing users | Fully backward compatible; migration is opt-in |
| Complexity creep | Config resolver centralizes logic; tests ensure correctness |

---

## 10. Recommendation

Proceed with implementation after architectural review. This is a significant UX improvement that aligns with the v2.3 "Curation not Ceremony" philosophy - extending it from reducing ceremony to eliminating it entirely for users who want zero friction.

**Suggested version:** v2.4.0 (minor version bump - new feature, backward compatible)

---

## Appendix A: Current Config Options

For reference, all current config options:

```python
# Directories
DOCS_DIR = 'docs'
LOGS_DIR = 'docs/logs'
CONTEXT_MAP_FILE = 'Ontos_Context_Map.md'

# Workflow
ENFORCE_ARCHIVE_BEFORE_PUSH = True
REQUIRE_SOURCE_IN_LOGS = True
DEFAULT_SOURCE = None

# Memory
LOG_RETENTION_COUNT = 15
AUTO_CONSOLIDATE = True
CONSOLIDATION_THRESHOLD_DAYS = 30

# UX
SMALL_CHANGE_THRESHOLD = 20

# Validation
MAX_DEPENDENCY_DEPTH = 5
ALLOWED_ORPHAN_TYPES = ['product', 'strategy', 'kernel']
SKIP_PATTERNS = ['archive/', 'README.md', ...]
```

---

## Appendix B: Session Timeline

| Time | Discussion Point | Decision |
|------|------------------|----------|
| Start | Root directory cleanup | Archive planning docs |
| +10m | Migrate script flags archive files | Fix to skip archive/ |
| +15m | Version bump discussion | 2.3.1 for bug fix |
| +20m | "Consolidate Ontos" not in agent instructions | Research what it does |
| +30m | Consolidation won't be used manually | Integrate into Maintain |
| +35m | Installation should ask preference | Add AUTO_CONSOLIDATE prompt |
| +40m | What other configs exist? | Full config review |
| +45m | Reframe: what do users need? | Three questions model |
| +50m | Automation spectrum idea | Auto/Prompted/Advisory modes |
| +55m | Two-tier config proposal | Mode + individual overrides |
| +60m | This needs architectural review | Write this document |

---

*Document generated for architectural review. Please provide feedback on design decisions, open questions, and implementation approach.*
