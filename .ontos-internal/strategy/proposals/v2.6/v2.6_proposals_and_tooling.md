---
id: v2_6_proposals_and_tooling
type: strategy
status: draft
depends_on: [v2_strategy]
concepts: [architecture, ontology, proposals, workflow, validation]
---

# V2.6 Proposal: Proposals Workflow & Validation (Revised)

**Date:** 2025-12-17 (Revised)
**Author:** Claude Opus 4.5 (Architect)
**Status:** Draft - Revised after deep analysis
**Revision:** 2.0 - Simplified based on codebase analysis

---

## 1. Executive Summary

This proposal extends Ontos v2.5 with:
1. **Rejection Recording** - Using existing decision_history.md format for rejected proposals
2. **Status Validation** - Adding `VALID_STATUS` enum and `status: rejected`
3. **Schema Fixes** - Correcting event_type mismatch between schema and config
4. **Lint Improvements** - Stale proposal warnings, draft indicators
5. **Version Release Workflow** - Contributor-mode reminder for changelog/version updates

**What was removed from v1.0:** Three new scripts (create/approve/reject) - manual workflow is simpler and sufficient.

**Key principle:** All features work in both contributor mode (.ontos-internal/) and user mode (docs/).

---

## 2. Problem Statement

### 2.1 Current State

| Issue | Impact | Evidence |
|-------|--------|----------|
| Rejected ideas not recorded | Re-analyzing same rejected ideas | No rejections in decision_history.md |
| No status validation | Invalid statuses accepted silently | No `VALID_STATUS` enum (unlike `VALID_TYPES`) |
| Schema/config mismatch | Confusion about valid event_types | Schema: `implementation` / Config: `feature, fix, refactor` |
| No stale proposal detection | Proposals accumulate without review | No lint warning for old drafts |
| Version releases miss changelog | v2.5.1, v2.5.2 shipped without entries | No reminder when .ontos/scripts/ changes |

### 2.2 What Already Exists (No Change Needed)

| Feature | Status | Location |
|---------|--------|----------|
| `proposals/` directory | ✅ Created by ontos_init.py | `docs/strategy/proposals/`, `docs/archive/proposals/` |
| `status: draft` | ✅ In schema | schema.md line 18 |
| Outcome column in decision_history | ✅ Already exists | `Decision / Outcome` column |
| `status: deprecated` | ✅ In schema | schema.md line 18 |

---

## 3. Design Decisions

### 3.1 Rejection Recording (Using Existing Format)

**Current decision_history.md format (no change needed):**
```markdown
| Date | Slug | Event | Decision / Outcome | Impacted | Archive Path |
|:-----|:-----|:------|:-------------------|:---------|:-------------|
| 2025-12-12 | blocking-hook | feature | Pre-push hook blocks until session archived. Rejected advisory-only. | v2_architecture | `.ontos-internal/archive/...` |
```

**Recording a rejection (manual process):**
```markdown
| 2025-12-17 | redis-cache | decision | REJECTED: Too complex for current scale. Revisit at 10k users. | v2_strategy | `archive/proposals/redis-cache-proposal.md` |
```

**No new columns needed.** The existing format supports rejections - we just haven't used it.

### 3.2 Status Validation

**Add to `ontos_config_defaults.py`:**
```python
# Valid status values (single source of truth)
VALID_STATUS = {'draft', 'active', 'deprecated', 'archived', 'rejected'}

# Status descriptions for documentation
STATUS_DEFINITIONS = {
    'draft': 'Work in progress (proposals, incomplete docs)',
    'active': 'Current truth (approved, in use)',
    'deprecated': 'Past truth (superseded, kept for reference)',
    'archived': 'Historical record (logs moved to archive)',
    'rejected': 'Considered but not approved (proposals only)',
}
```

### 3.3 Schema Fix (event_type Mismatch)

**Current schema.md (WRONG):**
```yaml
event_type: enum | exploration, decision, implementation, chore
```

**Corrected to match config:**
```yaml
event_type: enum | feature, fix, refactor, exploration, chore, decision
```

### 3.4 Proposal Lifecycle (Manual Workflow)

```
┌─────────────┐
│   CREATE    │  → Create file in strategy/proposals/ with status: draft
│status: draft│
└──────┬──────┘
       │
┌──────▼──────┐
│   REVIEW    │  → Share with reviewers, iterate
└──────┬──────┘
       │
   ┌───┴───┐
   ▼       ▼
┌──────┐ ┌──────┐
│APPROVE│ │REJECT│
└──┬───┘ └──┬───┘
   │        │
   ▼        ▼
Change    Move to archive/proposals/
status    Change status: rejected
to active Add rejection metadata
   │        │
   └───┬────┘
       ▼
Record in decision_history.md
```

**No scripts needed.** This is a 3-step manual process:
1. Edit frontmatter (change status)
2. Move file if rejected (to archive/proposals/)
3. Add row to decision_history.md

### 3.5 Rejection Metadata (Frontmatter)

When rejecting a proposal, update frontmatter:
```yaml
---
id: redis_cache_proposal
type: strategy
status: rejected
rejected_date: 2025-12-17
rejected_reason: "Too complex for current scale"
rejected_by: "Claude Opus 4.5"
revisit_when: "10k users"  # Optional
depends_on: [v2_strategy]
---
```

---

## 4. Deliverables

### 4.1 Config Changes

**File:** `.ontos/scripts/ontos_config_defaults.py`

```python
# =============================================================================
# STATUS VALUES (v2.6+)
# =============================================================================

VALID_STATUS = {'draft', 'active', 'deprecated', 'archived', 'rejected'}

STATUS_DEFINITIONS = {
    'draft': 'Work in progress (proposals, incomplete docs)',
    'active': 'Current truth (approved, in use)',
    'deprecated': 'Past truth (superseded, kept for reference)',
    'archived': 'Historical record (logs moved to archive)',
    'rejected': 'Considered but not approved (proposals only)',
}

# Stale thresholds (days)
PROPOSAL_STALE_DAYS = 60  # Warn if draft proposal older than this
```

### 4.2 Schema Fix

**File:** `.ontos-internal/atom/schema.md`

Change line 18:
```markdown
| `status` | enum | Yes | `active`, `draft`, `deprecated`, `archived`, `rejected` |
```

Change line 26:
```markdown
| `event_type` | enum | Yes | `feature`, `fix`, `refactor`, `exploration`, `chore`, `decision` |
```

Add new section:
```markdown
### 3.2 Type: `strategy` (when status: rejected)
| Field | Type | Required | Description |
|---|---|---|---|
| `rejected_date` | date | Yes | Date proposal was rejected |
| `rejected_reason` | string | Yes | Why it was rejected |
| `rejected_by` | string | No | Who rejected it |
| `revisit_when` | string | No | Conditions to reconsider |
```

### 4.3 Context Map Updates

**File:** `.ontos/scripts/ontos_generate_context_map.py`

**4.3.1 Status Indicator**
Show `[draft]` or `[rejected]` suffix for non-active documents:
```python
def get_status_indicator(status: str) -> str:
    """Return status indicator for non-active documents."""
    if status in ('draft', 'rejected', 'deprecated'):
        return f' [{status}]'
    return ''
```

Output:
```markdown
### STRATEGY
- **v2_strategy** (v2_strategy.md) ~2,600 tokens
- **s3_archive_proposal** (s3-archive-analysis.md) ~4,000 tokens [draft]
```

**4.3.2 Status Validation Warning**
```python
from ontos_config_defaults import VALID_STATUS

if status not in VALID_STATUS:
    warnings.append(f"- [LINT] **{doc_id}**: Invalid status '{status}' (valid: {VALID_STATUS})")
```

**4.3.3 Stale Proposal Warning**
```python
from ontos_config_defaults import PROPOSAL_STALE_DAYS

if status == 'draft':
    age_days = (datetime.now() - get_git_last_modified(filepath)).days
    if age_days > PROPOSAL_STALE_DAYS:
        warnings.append(
            f"- [LINT] **{doc_id}**: Draft proposal is {age_days} days old\n"
            f"  Action: Approve, reject, or update"
        )
```

**4.3.4 Skip Orphan Check for Drafts**
```python
# Drafts are naturally orphans (nothing depends on them yet)
if status == 'draft':
    continue  # Skip orphan warning
```

### 4.4 Config Cleanup

**File:** `.ontos/scripts/ontos_config.py`

Remove or clarify the `drafts/` skip pattern:
```python
# Before (confusing - we use proposals/, not drafts/)
SKIP_PATTERNS = ['_template.md', 'drafts/']

# After (clear)
SKIP_PATTERNS = ['_template.md']  # proposals/ is NOT skipped - we want to see drafts
```

### 4.5 Version Release Workflow (Contributor-Mode Only)

**File:** `.ontos/scripts/ontos_pre_push_check.py`

Add check that only runs in contributor mode:

```python
def check_version_reminder() -> list[str]:
    """Remind contributors to update changelog when shipping new versions.

    Only runs in contributor mode (Project Ontos repo itself).
    Returns list of warnings (empty if no issues).
    """
    from ontos_config_defaults import is_ontos_repo

    if not is_ontos_repo():
        return []  # Skip for users - they don't ship Ontos versions

    warnings = []

    # Get files changed in this push
    result = subprocess.run(
        ['git', 'diff', '--name-only', '@{push}..HEAD'],
        capture_output=True, text=True
    )
    if result.returncode != 0:
        return []

    changed_files = set(result.stdout.strip().split('\n'))

    # Check if .ontos/scripts/ files were modified
    scripts_changed = any(f.startswith('.ontos/scripts/') for f in changed_files)

    if not scripts_changed:
        return []

    # Check if version/changelog were also updated
    version_updated = '.ontos/scripts/ontos_config_defaults.py' in changed_files
    changelog_updated = 'Ontos_CHANGELOG.md' in changed_files

    if scripts_changed and not (version_updated and changelog_updated):
        warnings.append(
            "⚠️  CONTRIBUTOR REMINDER: .ontos/scripts/ modified\n"
            "   If shipping a new version, remember to update:\n"
            "   1. ONTOS_VERSION in ontos_config_defaults.py\n"
            "   2. Ontos_CHANGELOG.md with release notes\n"
        )

    return warnings
```

**Behavior:** Advisory warning only (does not block push).

### 4.6 Dual-Mode Matrix Document

**File:** `.ontos-internal/reference/Dual_Mode_Matrix.md`

New reference document tracking dual-mode support for all Ontos features:

- **Directory mappings** - Which paths map to which mode
- **Script support** - Which scripts work in which mode
- **Path helpers** - All `ontos_lib.py` functions with mode behavior
- **Features** - Full feature matrix with mode support
- **Config settings** - Which settings apply to which mode
- **Testing requirements** - Checklist for new features
- **Common pitfalls** - How to avoid mode-related bugs

**Purpose:** Prevents future v2.5.2-style bugs where features are developed only for contributor mode. Contributors must update this matrix when adding features.

---

## 5. Dual-Mode Support

All features must work in both modes:

| Feature | Contributor Mode | User Mode |
|---------|------------------|-----------|
| proposals/ directory | `.ontos-internal/strategy/proposals/` | `docs/strategy/proposals/` |
| archive/proposals/ | `.ontos-internal/archive/proposals/` | `docs/archive/proposals/` |
| Status validation | ✅ Same code | ✅ Same code |
| Stale proposal lint | ✅ Same code | ✅ Same code |
| Version release reminder | ✅ Runs | ❌ Skipped (not applicable) |

**Testing requirement:** All new lint rules must be tested in both `--mode=contributor` and `--mode=user`.

---

## 6. File Changes Summary

| File | Change | Contributor | User |
|------|--------|-------------|------|
| `.ontos/scripts/ontos_config_defaults.py` | Add VALID_STATUS, PROPOSAL_STALE_DAYS | ✅ | ✅ |
| `.ontos/scripts/ontos_generate_context_map.py` | Status indicator, validation, stale lint | ✅ | ✅ |
| `.ontos/scripts/ontos_pre_push_check.py` | Version release reminder | ✅ | ❌ (skipped) |
| `.ontos/scripts/ontos_config.py` | Remove `drafts/` from SKIP_PATTERNS | ✅ | ✅ |
| `.ontos-internal/atom/schema.md` | Fix event_type, add rejected status | ✅ | N/A |
| `.ontos-internal/reference/Dual_Mode_Matrix.md` | **NEW** - Feature support matrix | ✅ | N/A |
| `Ontos_Manual.md` | Document proposal workflow | ✅ | ✅ |
| `Ontos_Agent_Instructions.md` | Add proposal awareness | ✅ | ✅ |

---

## 7. Testing Plan

### 7.1 Unit Tests

| ID | Test | Mode | Expected |
|----|------|------|----------|
| T1 | Valid status values accepted | Both | No warning |
| T2 | Invalid status triggers lint warning | Both | Warning shown |
| T3 | Draft proposal shows [draft] indicator | Both | Indicator in context map |
| T4 | Stale draft (>60 days) triggers warning | Both | Lint warning |
| T5 | Fresh draft (<60 days) no warning | Both | No warning |
| T6 | Orphan check skips drafts | Both | No orphan warning for drafts |
| T7 | Version reminder runs in contributor mode | Contributor | Warning shown |
| T8 | Version reminder skipped in user mode | User | No warning |

### 7.2 Integration Tests

| ID | Test | Expected |
|----|------|----------|
| T9 | Full lint run with mixed statuses | Correct warnings for each |
| T10 | Context map generation with proposals | [draft] indicators shown |
| T11 | Pre-push with scripts change (contributor) | Version reminder shown |
| T12 | Pre-push with scripts change (user) | No reminder (skipped) |

---

## 8. Migration

### 8.1 Existing Documents

**No migration needed.** All changes are additive:
- Existing `status: active` documents work unchanged
- New `status: rejected` is opt-in
- Validation warnings are advisory (don't break builds)

### 8.2 Schema Event Type

Existing logs with `event_type: implementation` should be updated to `feature` or `chore` as appropriate. This can be done gradually - validation will warn but not fail.

---

## 9. What Was Removed (Compared to v1.0)

| Feature | Why Removed |
|---------|-------------|
| `ontos_create_proposal.py` | Creating a file with frontmatter is trivial - no script needed |
| `ontos_approve_proposal.py` | Changing status + adding to decision_history is 2 manual steps |
| `ontos_reject_proposal.py` | Same - manual process is simple enough |
| `--proposal` flag for end_session | Proposals aren't session logs - different mental model |
| New decision_history format | Existing format already has Outcome column |
| S3 archive companion feature | Separate proposal, not part of v2.6 |

**Rationale:** These scripts would add maintenance burden without proportional value. A documented manual workflow achieves the same goal with less code.

---

## 10. Open Questions

### Q1: Should `status: rejected` docs appear in context map?

| Option | Behavior |
|--------|----------|
| A: Never include | Saves tokens (RECOMMENDED) |
| B: Include with `--include-rejected` flag | Opt-in for comprehensive recall |

### Q2: Stale proposal threshold

| Option | Days |
|--------|------|
| A: 30 | Aggressive |
| B: 60 | Moderate (RECOMMENDED) |
| C: Configurable | User sets PROPOSAL_STALE_DAYS |

---

## 11. Approval Checklist

| Reviewer | Status | Date | Notes |
|----------|--------|------|-------|
| Claude (Architect) | REVISED | 2025-12-17 | v2.0 - Simplified after analysis |
| Codex | PENDING | — | — |
| Gemini | PENDING | — | — |
| Human (Jonathan) | PENDING | — | — |

---

## 12. References

- [Session Log: Proposals Architecture](.ontos-internal/logs/2025-12-17_v2-5-1-proposals-architecture.md)
- [V2.5 Implementation Plan](.ontos-internal/strategy/v2.5/v2.5_promises_implementation_plan.md)
- [Schema Specification](.ontos-internal/atom/schema.md)
