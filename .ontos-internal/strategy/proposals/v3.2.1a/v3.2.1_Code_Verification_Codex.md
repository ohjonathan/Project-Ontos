# v3.2.1 Code Verification (Adversarial) — PR #61

**Review signed by:**
- **Role:** Adversarial Reviewer (Verification)
- **Model:** Codex (OpenAI)
- **Review Type:** Code Verification (Phase D.5)

---

## Issue Verification

### X-H1: Legacy config overrides ignored (`resolve_config()` always default)

**Original Issue:** Legacy `ontos_config.py` overrides on `PYTHONPATH` are ignored; `resolve_config()` always returns the default (breaking change in patch release).
**CA's Fix:** No change detected in current PR head.

**Verification:**
- [ ] Code change is correct
- [ ] Issue is actually fixed (not just papered over)
- [ ] No new issues introduced by the fix
- [ ] Test exists for this fix

**Verdict:** ❌ Not Fixed

**Evidence:**
- Repro still returns `None` even with `ontos_config.py` on `PYTHONPATH` (see Regression Check).

---

### X-M1: `ONTOS_VERSION` import removed from `ontos.core.proposals`

**Original Issue:** `from ontos.core.proposals import ONTOS_VERSION` fails with `ImportError`.
**CA's Fix:** No change detected in current PR head.

**Verification:**
- [ ] Code change is correct
- [ ] Issue is actually fixed (not just papered over)
- [ ] No new issues introduced by the fix
- [ ] Test exists for this fix

**Verdict:** ❌ Not Fixed

**Evidence:**
- Import still fails with `ImportError`.

---

### X-M2: Key Documents list shows top 5 instead of top 3

**Original Issue:** Spec calls for top 3; code returns top 5.
**CA's Fix:** No change detected in current PR head.

**Verification:**
- [ ] Code change is correct
- [ ] Issue is actually fixed (not just papered over)
- [ ] No new issues introduced by the fix
- [ ] Test exists for this fix

**Verdict:** ❌ Not Fixed

**Evidence:**
- Generated Tier 1 summary still lists 5 entries when >3 are available.

---

### X-M3: `pending_curation` coerced to `draft`

**Original Issue:** `pending_curation` (valid curation status) is not in `DocumentStatus`, so it downgrades to `draft` in parsing.
**CA's Fix:** No change detected in current PR head.

**Verification:**
- [ ] Code change is correct
- [ ] Issue is actually fixed (not just papered over)
- [ ] No new issues introduced by the fix
- [ ] Test exists for this fix

**Verdict:** ❌ Not Fixed

**Evidence:**
- `status: pending_curation` still warns and defaults to `draft`.

---

### X-L1: `argparse.SUPPRESS` not hiding deprecated commands

**Original Issue:** `ontos --help` still lists deprecated/internal commands with `==SUPPRESS==`.
**CA's Fix:** No change detected in current PR head.

**Verification:**
- [ ] Code change is correct
- [ ] Issue is actually fixed (not just papered over)
- [ ] No new issues introduced by the fix
- [ ] Test exists for this fix

**Verdict:** ❌ Not Fixed

**Evidence:**
- `ontos --help` output still shows `agent-export`, `hook`, `tree`, `validate` with `==SUPPRESS==`.

---

## Regression Check

Commands executed:

```bash
pytest tests/ -v
ontos --version
ontos --help
ontos map --help
ontos scaffold --help
ontos tree --help
ontos validate --help
rg "_scripts" ontos/ --type py
rg "ontos_config_defaults" ontos/ --type py
python -c "from ontos.core.paths import PROJECT_ROOT, is_ontos_repo; print(PROJECT_ROOT); print(is_ontos_repo())"
python -c "from ontos.core.proposals import ONTOS_VERSION; print(ONTOS_VERSION)"
python -c "import ast; tree = ast.parse(open('ontos/cli.py').read()); imports = [n for n in ast.walk(tree) if isinstance(n, ast.Import)]; print([a.name for i in imports for a in i.names])"
python -c "import ontos._scripts"
python -c "import ontos.mcp"
# Edge cases re-run
# - pending_curation parsing
# - key docs top-N
# - legacy config override on PYTHONPATH
# - TOML falsy values
```

| Check | Status |
|-------|--------|
| All tests pass | ✅ (552 passed, 2 skipped) |
| No new regressions | ❌ (original issues persist) |
| Import chain clean | ❌ (`ONTOS_VERSION` import still fails) |
| Edge cases handled | ❌ (`pending_curation`, key docs top 5, legacy config override) |

---

## New Issues Introduced by Fixes

| # | Issue | How Found | Impact |
|---|-------|-----------|--------|
| None | — | — | — |

---

## Verdict

**Recommendation:** Request further fixes
**Remaining concerns:**
- X-H1 legacy config override still ignored
- X-M1 `ONTOS_VERSION` import still broken
- X-M2 Key Documents still top 5
- X-M3 `pending_curation` still coerced to `draft`
- X-L1 suppressed commands still visible in `--help`

