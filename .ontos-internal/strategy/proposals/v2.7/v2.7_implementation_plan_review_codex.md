---
id: v2_7_implementation_plan_review_codex
type: strategy
status: complete
depends_on: []
---

# Review: v2.7 Implementation Plan (Version 1.0.0, 2025-12-19)

Source reviewed: `.ontos-internal/strategy/proposals/v2.7/v2.7_implementation_plan.md` (DRAFT).

## Findings
- **Scope/type ambiguity for `describes`:** Recommendations say “atom only,” but examples imply manuals/agent instructions. Allowed source/target types and coexistence with `depends_on` are not fixed, risking inconsistent graphs.
- **Staleness enforcement weak:** All checks are warnings; no backlog view or strict mode. Stale docs may linger indefinitely without a blocking gate or actionable queue.
- **Performance risk:** Git-based last-mod per described ID may exceed the <1s goal on larger repos; caching/batching is noted but not specified in implementation/tests.
- **Immutable history determinism not guaranteed:** Sort rules are proposed but not bound to CI; no “ledger == logs” assertion or malformed-log handling. Merge workflow assumes happy path.
- **CLI fragmentation risk:** Introducing `ontos_verify.py` pre-v2.8 may churn once unified CLI arrives; migration path not stated.
- **Path alignment:** Change summary references `.ontos-internal/atom/schema.md`; confirm actual paths to avoid drift during implementation.
- **Validation severity unclear:** Many WARNs (empty describes, missing verified, stale) with no escalation/strict mode; silent rot risk.
- **Testing gaps:** Perf tests lack repo-size targets; merge/conflict tests don’t cover archived vs active logs consistency or non-git fallback behavior.

## Suggestions
- **Lock `describes` matrix:** Decide who can describe whom (recommended: atom→atom) and document how it coexists with `depends_on`; disallow self-describe.
- **Add stale backlog + strict mode:** Provide a summarized stale-docs section/command and an optional blocking mode (CI/pre-push) to prevent perpetual warnings.
- **Specify git lookup strategy:** Batch/cache git queries; set perf budgets (e.g., 50 describes <300ms) and test against representative repo sizes.
- **Codify immutable-history rules:** Canonical sort, required metadata, regenerate command, CI check comparing ledger to logs, and behavior on malformed/missing logs.
- **Plan CLI migration:** Mark `ontos_verify.py` as interim and map to `ontos.py verify` in v2.8; avoid long-lived duplication.
- **Clarify real file paths:** Align change list with current repo layout to prevent implementer misfires.
- **Define validation severity:** Unknown IDs = error; missing verified = warn; stale = warn by default with optional strict fail; empty describes = warn or error per policy.
- **Broaden tests:** Add cases for archived vs active logs in history gen, dual-branch merges with stale docs, shallow/non-git environments, and perf thresholds.

## Open Question Votes
- **2.3.A (who can use `describes`):** Atom only.
- **2.3.B (who can be described):** Atom only.
- **2.3.C (self-describe):** Disallow.
- **2.4.A (last modified):** Git with fallback, plus caching/batching.
- **2.4.B (precision):** Day.
- **2.4.C (when to check):** All (map + archive + pre-push) with optional strict mode.
- **2.6.A (update verified):** Manual primary + helper command; avoid auto-yes prompts.
- **2.8.A (audit placement):** Both flag + section.
- **2.8.B (verify script):** New script now, migrate to unified CLI in v2.8.
- **2.9.A (migration):** Silent opt-in for v2.7; prompted suggestions in v2.8.
- **3.3.A (regen history):** Context map generation.
- **3.3.B (date source):** Frontmatter with filename fallback.
- **3.3.C (location):** Current.
- **3.3.D (git tracking):** Committed + generated header; enforce regen check in CI.
- **3.5.A (consolidation vs history):** Independent.
- **3.6.A (merge helper):** No helper for v2.7; document workflow.

## Additional Considerations
- **Backcompat:** Define handling for legacy logs missing `date` or with malformed frontmatter during history regen (fail vs skip with warning).
- **Git edge cases:** Specify behavior in shallow clones or detached worktrees for staleness checks.
- **Guidance:** Provide cookbook examples for common docs (manual, agent instructions) showing canonical `describes` usage and verification flow to reduce mis-tagging.
