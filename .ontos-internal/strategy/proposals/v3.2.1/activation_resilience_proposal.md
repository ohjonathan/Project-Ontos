---
id: v3_2_1_activation_resilience_proposal
type: strategy
status: draft
depends_on: [v3_2_re_architecture_support_proposal, ontos_agent_instructions]
---

# v3.2.1: Activation Resilience After Context Compaction

**Author:** Antigravity  
**Date:** 2026-01-31  
**Status:** Draft

---

## 1. Problem Statement

### Observed Failure

In a finance-engine session, after `/compact`, Claude failed to recognize "activate ontos":

```
❯ /compact
  ⎿  Compacted (ctrl+o to see full summary)

❯ activate ontos

⏺ Let me read the Ontos Manual to understand what "activate ontos" means.
⏺ [searches filesystem, can't find manual]
⏺ The referenced manual (docs/reference/Ontos_Manual.md) doesn't exist.

User answered Claude's questions:
  · What does 'activate ontos' mean? → Internalize context map
```

**Expected Behavior:** Claude should immediately execute the activation workflow without asking.

**Actual Behavior:** Claude treated it as a novel research task and asked for clarification.

### Root Causes

| # | Cause | Impact |
|---|-------|--------|
| 1 | **AGENTS.md not re-read after compaction** | Claude loses the activation instructions |
| 2 | **"activate ontos" not mapped as trigger phrase** | Claude doesn't pattern-match to AGENTS.md |
| 3 | **CLAUDE.md references non-existent manual** | Claude gets stuck in research mode |
| 4 | **No compaction-specific recovery instructions** | No guidance on what to do post-/compact |

---

## 2. Design Goals

1. **Zero-clarification activation** — "activate ontos" should work without user explanation
2. **Self-contained instructions** — AGENTS.md should not require external files to function
3. **Compaction survival** — Instructions should guide re-activation after `/compact`
4. **Cross-platform** — Works for Claude Code, Cursor, Codex, and other agents

---

## 3. Proposed Changes

### 3.1 Add Trigger Phrase Section to AGENTS.md Template

**Location:** `ontos/commands/agents.py` → `AGENTS_TEMPLATE`

**Add at top of template (before "What is Activation?"):**

```markdown
## Trigger Phrases
If user says ANY of these, execute Ontos Activation below:
- "activate ontos"
- "ontos"
- "/ontos"
- "load context"
- "reload context"

Do NOT ask for clarification. Just execute the steps.
```

### 3.2 Add Compaction Recovery Section

**Add after "Re-Activation Trigger":**

```markdown
## After Context Compaction (/compact)
If you just regained context after compaction and:
- Don't recognize this project
- Can't recall doc count or recent work
- Are unsure about file locations

Then: **Re-read this file (AGENTS.md) and execute Ontos Activation.**
```

### 3.3 Remove External Manual Reference from CLAUDE.md

**Current CLAUDE.md:**
```markdown
For more information, see `docs/reference/Ontos_Manual.md`.
```

**Proposed:** Remove this line or make it conditional on manual existence.

### 3.4 Make AGENTS.md Self-Contained

Ensure all critical information is embedded directly:
- Full activation workflow (already present)
- Quick reference commands (already present)
- Core invariants (already present)

No external dependencies for basic activation.

---

## 4. Implementation Spec

### Files to Modify

| File | Change |
|------|--------|
| `ontos/commands/agents.py` | Update `AGENTS_TEMPLATE` with trigger phrases and compaction recovery |
| `ontos/commands/init.py` | Update `CLAUDE_TEMPLATE` to remove/conditionalize manual reference |
| `tests/commands/test_agents.py` | Add tests for new template sections |

### Template Changes (Detailed)

**AGENTS_TEMPLATE additions:**

```python
AGENTS_TEMPLATE = '''# AGENTS.md

This project uses **Ontos** for documentation management.

Generated by Ontos {version} on {timestamp}

## Trigger Phrases
If user says ANY of these, execute Ontos Activation below:
- "activate ontos"
- "ontos" 
- "/ontos"
- "load context"
- "reload context"

Do NOT ask for clarification. Just execute the steps.

## Current Project State
...
'''
```

---

## 5. Verification Plan

### Automated Tests
1. Test that generated AGENTS.md contains "Trigger Phrases" section
2. Test that generated AGENTS.md contains "After Context Compaction" section
3. Test that CLAUDE.md doesn't hard-reference missing files

### Manual Verification
1. In a test project, run `ontos init` → verify AGENTS.md content
2. Simulate compaction scenario → verify activation still works
3. Test all trigger phrases → confirm they're documented

---

## 6. Alternatives Considered

| Alternative | Rejected Because |
|------------|------------------|
| Add activation to compaction summary | Not controllable by Ontos — depends on Claude's compaction behavior |
| Use Claude's built-in CLAUDE.md auto-read | Not all agents support this; AGENTS.md is more universal |
| Create `/activate` slash command workflow | Adds complexity; trigger phrases are simpler |

---

## 7. Open Questions

1. Should we add a `--check-compaction` flag to `ontos doctor`?
2. Should AGENTS.md include a version hash to detect staleness more reliably?

---

## 8. Decision Requested

Approve this proposal to proceed with implementation.
