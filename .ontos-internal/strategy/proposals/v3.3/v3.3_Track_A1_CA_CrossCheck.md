---
id: v3_3_track_a1_ca_crosscheck
type: strategy
status: active
depends_on: [v3_3_track_a1_implementation_spec, v3_3_merged_audit_findings]
concepts: [v3.3, track-a1, cross-check, spec-compliance]
---

# v3.3 Track A1 CA Cross-Check

## Cross-Check Summary

- Items fully matching spec: **8/12**
- Items with acceptable deviations: **1**
- Items with problematic deviations: **3**
- Items missing: **0**

## Cross-Check Matrix

| # | ID | Item | Implemented? | Matches Spec? | Deviations / Notes |
|---|---|---|---|---|---|
| 1 | CC-03 | Canonical parser contract | Partial | No | Canonical parser path is broadly adopted (`ontos/io/files.py:155`, `ontos/io/yaml.py:60`, `ontos/core/frontmatter.py:29`). Remaining contract split: `load_frontmatter()` only handles `OSError` and can still propagate parse failures (`ontos/io/files.py:148`), which breaks consistency vs `load_documents()` skip+issue behavior. |
| 8 | C-5 | `validate_describes_field()` list crash | Yes | Yes | List-safe handling is implemented in validator (`ontos/core/validation.py:40`) and no crash path remains for list input. |
| 9 | C-7 | `depends_on`/`impacts` non-list TypeError | Yes | Yes | Central normalization now handles scalar/list/object forms and records warnings through loader issues (`ontos/core/frontmatter.py:155`, `ontos/io/files.py:312`). |
| 10 | C-8 | Duplicate ID silent overwrite | Yes | Partial (acceptable) | Duplicate detection/reporting infrastructure is in place and reusable (`ontos/io/files.py:201`, `ontos/io/files.py:233`) and used by key commands. Deviation: `query` fails on duplicate IDs (`ontos/commands/query.py:165`) instead of spec’s warn+continue policy. |
| 25 | C-6 | Enum coercion ValueError-only | Yes | Yes | Enum coercion now handles ValueError + TypeError and emits loader issues (`ontos/core/frontmatter.py:234`, `ontos/core/frontmatter.py:266`, `ontos/io/files.py:300`). |
| 33 | CC-01 | Core→IO layer violation | Yes | Yes | Runtime snapshot assembly is moved to IO layer (`ontos/io/snapshot.py:18`); core snapshot remains IO-free (`ontos/core/snapshot.py:1`). |
| 36 | CC-05 | Duplicate `build_graph()` | Yes | Yes | Query-local graph builder removed; query calls core graph builder (`ontos/commands/query.py:11`, `ontos/commands/query.py:43`). |
| 37 | CC-06 | 21 obsolete enum checks | Yes | Yes | Defensive `hasattr(..., 'value')` checks are removed from target files; direct `.value` access is used. |
| 40 | CC-09 | Five loading patterns | Yes | Yes | Canonical loading pattern (`load_documents`/`load_frontmatter` + `parse_frontmatter_content`) is now used by map, maintain, query, verify, and promote flows. |
| 41 | CC-11 | Duplicate `normalize_depends_on` | Yes | Yes | Single normalization source via `normalize_reference_list` + `normalize_depends_on` wrapper is implemented and consumed by loader (`ontos/core/frontmatter.py:155`, `ontos/io/files.py:312`). |
| 42 | CC-16 | `validate_concepts()` never called | Partial | No | `validate_concepts()` is now invoked by orchestrator (`ontos/core/validation.py:105`) and includes structural checks. Gap: optional vocabulary validation is not implemented even though `known_concepts` is read (`ontos/core/validation.py:207`). |
| 44 | CC-19 | Asymmetric validation severity | Partial | No | Severity model is partially codified/configurable (`ontos/core/validation.py:31`, `ontos/core/graph.py:48`). Gap: full field-level model/rationale and consistent override application (`depends_on`/`impacts`/`describes`/`concepts`) is not fully delivered; `impacts` and `describes` remain hardcoded warning paths (`ontos/core/validation.py:180`, `ontos/core/validation.py:196`). |

## Deviations

1. **CC-03 (gap)**
- Spec asked for one canonical parsing contract with consistent caller handling.
- Implemented: mostly converged, but single-file load path still diverges in parse-error behavior.
- Classification: **Gap**.

2. **C-8 (acceptable improvement)**
- Spec asked `query` to warn+continue on duplicates.
- Implemented: `query` fails fast on duplicates.
- Classification: **Improvement** (stricter correctness), but policy mismatch from spec.

3. **CC-16 (gap)**
- Spec asked for concepts validation with structural checks and optional vocabulary check.
- Implemented: structural checks only.
- Classification: **Gap**.

4. **CC-19 (gap)**
- Spec asked for explicit field-level severity model with rationale and override plumbing.
- Implemented: partial severity model.
- Classification: **Gap**.

## Additional Checks

### Tests

Executed:
- `pytest -q tests/test_document_loading_contract_a1.py tests/test_validation_concepts_a1.py tests/core/test_snapshot.py tests/core/test_migration.py tests/commands/test_query_parity.py tests/commands/test_maintain.py tests/commands/test_map.py tests/commands/test_verify_parity.py tests/commands/test_promote_parity.py`
- `pytest -q tests/commands/test_consolidate_parity.py tests/commands/test_migrate_parity.py tests/commands/test_scaffold_parity.py`

Result:
- **58 passed, 1 failed**
- Failing test: `tests/commands/test_maintain.py::test_check_links_task_reports_broken_dependencies`
  - Current `_task_check_links` behavior demotes broken links to warning (`ontos/commands/maintain.py:558`), so task status returns success where test expects failure.

Coverage assessment:
- New direct coverage exists for loader contract and concepts structural validation.
- No clear direct coverage for all item-specific outcomes (notably #1 contract edge behavior, #10 command policy matrix, and full #44 field-level severity model).

### Settled Decision Compliance (Quick Check)

- **S4:** IO YAML parser is the canonical runtime path in core command loading (`load_documents(..., parse_frontmatter_content)`). **Mostly compliant**, with single-file error-contract inconsistency still present.
- **B5:** Duplicate-ID detection is implemented as reusable infrastructure (`DocumentLoadResult`) and consumed by commands. **Compliant**.

### Track B Readiness (Quick Check)

Not fully ready yet. Three of the four Track B prerequisites are still partial:
- `#1 (CC-03)` partial
- `#42 (CC-16)` partial
- `#44 (CC-19)` partial

`#10 (C-8)` groundwork is in place.

## Gaps

- Canonical parser contract is not fully unified for single-file loading (`load_frontmatter`).
- Concepts vocabulary validation path remains incomplete.
- Severity model codification is incomplete relative to spec’s explicit field-level contract.
- **Obvious regression outside matrix but in touched code:** `consolidate_command` uses `root` before assignment (`ontos/commands/consolidate.py:177`).

## Issues for Review Board Attention

1. Track B prerequisite closure for `#1`, `#42`, `#44`.
2. Confirm intended `maintain` severity behavior for broken dependencies vs current warning demotion.
3. Single-file parse error handling consistency (`load_frontmatter` vs `load_documents`).
4. Full severity model completeness and override path consistency.
5. Regression check on `ontos/commands/consolidate.py:177` (`root` undefined in execute path).

## Verdict

**Return to Developer**

Most A1 items are now implemented, but prerequisite contract gaps remain in `#1`, `#42`, and `#44`, and there is an obvious execution-path regression in `consolidate_command`.
