---
id: v3_3_track_a1_ca_crosscheck
type: strategy
status: active
depends_on: [v3_3_track_a1_implementation_spec, v3_3_merged_audit_findings]
concepts: [v3.3, track-a1, cross-check, spec-compliance]
---

# v3.3 Track A1 CA Cross-Check

## Cross-Check Summary

- Items fully matching spec: **3/12**
- Items with acceptable deviations: **1**
- Items with problematic deviations: **8**
- Items missing: **0**

## Cross-Check Matrix

| # | ID | Item | Implemented? | Matches Spec? | Deviations / Notes |
|---|---|---|---|---|---|
| 1 | CC-03 | Canonical parser contract | Partial | No | Canonical loader path is present (`ontos/io/files.py:155`, `ontos/io/yaml.py:60`, `ontos/core/frontmatter.py:29`), but legacy parser usage remains in command code (`ontos/commands/maintain.py:465`). `load_frontmatter()` still has a different error contract from `load_documents()` (`ontos/io/files.py:135`). |
| 8 | C-5 | `validate_describes_field()` list crash | Yes | Partial | Crash is fixed via list-based validation (`ontos/core/validation.py:27`), but spec-required non-string member warnings are not explicit because normalization stringifies list members (`ontos/core/staleness.py:142`). |
| 9 | C-7 | `depends_on`/`impacts` non-list TypeError | Yes | Partial | Central normalization exists (`ontos/core/frontmatter.py:155`, `ontos/io/files.py:292`), but invalid nested/object types are skipped without surfaced warnings because warning callback is not wired in loader paths. |
| 10 | C-8 | Duplicate ID silent overwrite | Yes | Partial (acceptable) | Duplicate detection infra is implemented and reusable (`ontos/io/files.py:201`, `ontos/io/files.py:232`) with command adoption (`ontos/commands/map.py:717`, `ontos/commands/maintain.py:545`). Deviation: `query` fails on duplicates (`ontos/commands/query.py:165`) instead of spec’d warn+continue. This is stricter/safety-improving but diverges from spec policy table. |
| 25 | C-6 | Enum coercion ValueError-only | Partial | No | `TypeError` is now handled (`ontos/core/frontmatter.py:234`, `ontos/core/frontmatter.py:260`), but spec-required issue reporting with problematic value is not implemented. `invalid_enum` exists as a code label only (`ontos/io/files.py:23`). |
| 33 | CC-01 | Core→IO layer violation | Yes | Yes | `create_snapshot` moved out of core (`ontos/io/snapshot.py:18`), core snapshot no longer imports IO (`ontos/core/snapshot.py:1`), and call sites were updated (`ontos/commands/export_data.py:14`, `ontos/commands/migration_report.py:13`). |
| 36 | CC-05 | Duplicate `build_graph()` | Yes | Yes | Query-local graph builder removed; query now uses core graph builder (`ontos/commands/query.py:11`, `ontos/commands/query.py:43`). |
| 37 | CC-06 | 21 obsolete enum checks | No | No | Defensive enum branches remain across all target files, e.g. `ontos/core/graph.py:64`, `ontos/core/migration.py:81`, `ontos/core/snapshot.py:44`, `ontos/core/validation.py:143`, `ontos/commands/export_data.py:72`, `ontos/commands/map.py:375`. |
| 40 | CC-09 | Five loading patterns | Partial | No | Canonical loader adoption is broad (`ontos/commands/query.py:40`, `ontos/commands/map.py:717`, `ontos/commands/maintain.py:249`, `ontos/commands/verify.py:36`, `ontos/commands/promote.py:168`). Problematic gap: migration bug in verify (`files` undefined at `ontos/commands/verify.py:36`). Also mixed parsing remains in maintain proposal scan (`ontos/commands/maintain.py:465`). |
| 41 | CC-11 | Duplicate `normalize_depends_on` | Yes | Yes | Shared normalization source is established (`ontos/core/frontmatter.py:155`, `ontos/core/frontmatter.py:197`), and loader now delegates instead of duplicating inline logic (`ontos/io/files.py:292`). |
| 42 | CC-16 | `validate_concepts()` never called | Partial | No | Orchestrator now calls `validate_concepts()` (`ontos/core/validation.py:84`). But spec-required structural checks (non-string/empty/duplicates) and optional vocabulary check are not implemented; map also does not pass `known_concepts` (`ontos/commands/map.py:64`). |
| 44 | CC-19 | Asymmetric validation severity | Partial | No | A constant for broken `depends_on` severity was added (`ontos/core/graph.py:19`), but spec-required explicit severity model/rationale map and override plumbing are missing (no configurable mapping in `validation.py`; `build_graph()` signature unchanged at `ontos/core/graph.py:48`). |

## Deviations

1. **CC-03 (gap):**
   - Spec: runtime command loading converges on canonical parser/loader contract.
   - Implemented: major convergence completed, but legacy parser remains in `maintain` draft proposal flow.
   - Assessment: **Gap**.

2. **C-5 (gap):**
   - Spec: list-safe describes validation plus explicit non-string handling warnings.
   - Implemented: list-safe behavior only.
   - Assessment: **Gap**.

3. **C-7 (gap):**
   - Spec: invalid non-list/nested types emit warnings and are skipped.
   - Implemented: skip behavior exists; warning surfacing is incomplete.
   - Assessment: **Gap**.

4. **C-8 (improvement deviation):**
   - Spec: `query` warns+continues on duplicates.
   - Implemented: `query` fails on duplicates.
   - Assessment: **Improvement** (stricter correctness) but policy mismatch.

5. **C-6 (gap):**
   - Spec: enum coercion catches ValueError/TypeError and emits clear issue with bad value.
   - Implemented: exceptions handled, but issue emission is missing.
   - Assessment: **Gap**.

6. **CC-06 (regression vs spec):**
   - Spec: remove all 21 defensive enum branches.
   - Implemented: branches remain broadly.
   - Assessment: **Regression / not delivered**.

7. **CC-09 (regression/gap):**
   - Spec: canonical loading pattern across target commands.
   - Implemented: mostly migrated, but verify contains broken migration (`files` undefined) and maintain still has mixed parser path.
   - Assessment: **Regression + gap**.

8. **CC-16 (gap):**
   - Spec: concept validation integrated with explicit invalid-concept semantics and optional vocabulary checks.
   - Implemented: only "missing concepts on log" warning.
   - Assessment: **Gap**.

9. **CC-19 (gap):**
   - Spec: explicit, documented, configurable severity model.
   - Implemented: only hardcoded default constant for broken dependencies.
   - Assessment: **Gap**.

## Additional Checks

### Tests

- Changed tests in PR: `tests/core/test_snapshot.py`, `tests/core/test_migration.py`.
- Both changes are import-path adjustments for snapshot entrypoint, not broad A1 contract coverage.
- No PR-added tests for:
  - loader contract (`DocumentLoadResult` parse/duplicate/enum issue scenarios)
  - duplicate-ID policy matrix by command
  - concept validation semantics
  - severity override model
  - enum-defensive-branch removal

Executed in this cross-check:
- `pytest -q tests/core/test_snapshot.py tests/core/test_migration.py tests/io/test_files_status_parsing.py` -> pass
- `pytest -q tests/commands/test_query_parity.py tests/commands/test_maintain.py tests/commands/test_map.py tests/commands/test_verify_parity.py tests/commands/test_promote_parity.py tests/commands/test_scaffold_parity.py tests/commands/test_migrate_parity.py tests/commands/test_consolidate_parity.py` -> pass

### Settled Decision Compliance

- **S4 (IO YAML parser canonical):** **Mostly compliant**. Canonical path is implemented via `load_documents(..., parse_frontmatter_content)`, but not all command parsing paths are fully converged (notably `maintain` draft proposal scan).
- **B5 (reusable duplicate detection infra):** **Compliant**. Reusable duplicate detection exists in `DocumentLoadResult` (`ontos/io/files.py:31`) and is consumed by multiple commands.

### Track B Readiness (Quick Check)

- Foundation is **not yet solid enough** for Track B start, because three of four prerequisite items are only partially delivered:
  - `#1 CC-03`: partial
  - `#10 C-8`: mostly delivered (policy mismatch in query)
  - `#42 CC-16`: partial
  - `#44 CC-19`: partial
- Additional blocker-level concern: loader migration bug in `verify` (`ontos/commands/verify.py:36`).

## Gaps for Review Board Awareness

- `#37` is materially undelivered.
- `#42` and `#44` do not meet the explicit contract level needed for Track B inheritance.
- `#40` has a concrete implementation defect (`verify` undefined variable) indicating migration incompleteness.
- Test additions are insufficient for the contract changes introduced in A1.

## Issues for Review Board Attention

1. Parser/loader convergence boundaries, especially residual legacy parser calls.
2. Duplicate-ID command policy consistency (decide whether strict fail in query is intended).
3. Validation contract completeness for concepts and severity model configurability.
4. Enum contract cleanup completeness (`hasattr(..., 'value')` removals).
5. Loader migration correctness in `verify` and any untested paths.

## Verdict

**Return to Developer**

The implementation includes meaningful progress, but there are fundamental spec gaps in prerequisite contracts (#1, #42, #44) plus one major undelivered cleanup item (#37) and a concrete migration defect in `verify`.
