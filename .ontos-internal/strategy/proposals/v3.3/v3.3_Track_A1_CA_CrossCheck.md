---
id: v3_3_track_a1_ca_crosscheck
type: strategy
status: active
depends_on: [v3_3_track_a1_implementation_spec, v3_3_merged_audit_findings]
concepts: [v3.3, track-a1, cross-check, spec-compliance]
---

# v3.3 Track A1 CA Cross-Check

## Cross-Check Summary

- Items fully matching spec: **8/12**
- Items with acceptable deviations: **1**
- Items with problematic deviations: **3**
- Items missing: **0**

## Cross-Check Matrix

| # | ID | Item | Implemented? | Matches Spec? | Deviations / Notes |
|---|---|---|---|---|---|
| 1 | CC-03 | Canonical parser contract | Partial | No | Canonical parser/loader is broadly adopted (`ontos/io/files.py:155`, `ontos/io/yaml.py:60`, `ontos/core/frontmatter.py:29`), but `load_frontmatter()` still has a different error contract (only catches `OSError`, parse errors propagate) (`ontos/io/files.py:148`). Single-file callers may still surface inconsistent behavior (`ontos/commands/verify.py:224`). |
| 8 | C-5 | `validate_describes_field()` list crash | Yes | Yes | List-safe validation is implemented (`ontos/core/validation.py:40`) and no longer crashes on list input. |
| 9 | C-7 | `depends_on`/`impacts` non-list TypeError | Yes | Yes | Canonical normalization now handles scalar/list/object forms with warnings (`ontos/core/frontmatter.py:155`, `ontos/io/files.py:312`). |
| 10 | C-8 | Duplicate ID silent overwrite | Yes | Partial (acceptable) | Reusable duplicate detection is implemented in loader (`ontos/io/files.py:201`, `ontos/io/files.py:233`) and consumed by commands. Deviation: `query` fails on duplicates (`ontos/commands/query.py:165`) vs spec’s warn+continue policy. This is stricter than spec. |
| 25 | C-6 | Enum coercion ValueError-only | Yes | Yes | Coercion path now handles ValueError/TypeError and records issues (`ontos/core/frontmatter.py:234`, `ontos/core/frontmatter.py:266`, `ontos/io/files.py:300`). |
| 33 | CC-01 | Core→IO layer violation | Yes | Yes | Runtime snapshot creation moved to IO layer (`ontos/io/snapshot.py:18`), and `ontos/core/snapshot.py` no longer imports IO. |
| 36 | CC-05 | Duplicate `build_graph()` | Yes | Yes | Query-local graph builder removed; query uses core graph builder (`ontos/commands/query.py:11`, `ontos/commands/query.py:43`). |
| 37 | CC-06 | 21 obsolete enum checks | Yes | Yes | Defensive enum checks are removed in target files; direct `.value` access is used (no remaining `hasattr(..., 'value')` matches). |
| 40 | CC-09 | Five loading patterns | Yes | Yes | Canonical loading pattern is now used in key command flows (`map`, `maintain`, `query`, `verify`, `promote`) via `load_documents`/`load_frontmatter` and `parse_frontmatter_content`. |
| 41 | CC-11 | Duplicate `normalize_depends_on` | Yes | Yes | Single source of truth established via `normalize_reference_list` + wrapper (`ontos/core/frontmatter.py:155`, `ontos/core/frontmatter.py:197`) and adopted by loader (`ontos/io/files.py:312`). |
| 42 | CC-16 | `validate_concepts()` never called | Partial | No | It is now called by orchestrator (`ontos/core/validation.py:105`) and includes structural checks. Gap: vocabulary check is incomplete; `known_concepts` is read but not applied (`ontos/core/validation.py:207`). Also `map` does not provide known concepts (`ontos/commands/map.py:64`). |
| 44 | CC-19 | Asymmetric validation severity | Partial | No | Severity model is partially codified (`ontos/core/validation.py:31`, `ontos/core/graph.py:50`) and configurable for some paths. Gap: full field-level model from spec (`depends_on/impacts/describes/concepts` + rationale + uniform override plumbing) is not fully implemented; `impacts`/`describes` remain hardcoded warnings (`ontos/core/validation.py:194`, `ontos/core/validation.py:203`). |

## Deviations

1. **CC-03 (gap):**
   - Spec: canonical parser contract with consistent caller error handling.
   - Implemented: canonical path is in place, but single-file `load_frontmatter` parse error handling remains inconsistent.
   - Assessment: **Gap**.

2. **C-8 (acceptable improvement):**
   - Spec: `query` warns+continues on duplicates.
   - Implemented: `query` fails fast on duplicate IDs.
   - Assessment: **Improvement over spec** (stricter correctness), but behavior differs from the specified policy table.

3. **CC-16 (gap):**
   - Spec: include structural checks plus optional vocabulary checks when `known_concepts` is available.
   - Implemented: structural checks exist, vocabulary check path is not completed.
   - Assessment: **Gap**.

4. **CC-19 (gap):**
   - Spec: explicit and configurable field-level severity model with rationale.
   - Implemented: partial model; field-level consistency and override coverage are incomplete.
   - Assessment: **Gap**.

## Additional Checks

### Tests

Executed during cross-check:
- `pytest -q tests/test_document_loading_contract_a1.py tests/test_validation_concepts_a1.py tests/core/test_snapshot.py tests/core/test_migration.py tests/commands/test_query_parity.py tests/commands/test_maintain.py tests/commands/test_map.py tests/commands/test_verify_parity.py tests/commands/test_promote_parity.py`

Result:
- **52 passed, 1 failed**
- Failure: `tests/commands/test_maintain.py::test_check_links_task_reports_broken_dependencies`
  - Current `maintain` behavior treats broken links as warning via severity override in `_task_check_links` (`ontos/commands/maintain.py:558`), so task returns success where test expects failure.

Coverage observations vs A1 items:
- Good direct coverage added for loader-contract and concept-structure behavior (`tests/test_document_loading_contract_a1.py`, `tests/test_validation_concepts_a1.py`).
- No clear direct tests for duplicate-ID command policy matrix (#10) or full severity-asymmetry contract (#44).
- Snapshot boundary tests are updated and passing (`tests/core/test_snapshot.py`, `tests/core/test_migration.py`).

### Settled Decision Compliance (Quick Check)

- **S4:** IO YAML parser is effectively canonical in runtime loading paths (`load_documents(..., parse_frontmatter_content)` across key commands). **Mostly compliant**, with remaining single-file error-contract inconsistency.
- **B5:** Duplicate ID detection exists as reusable infrastructure in `DocumentLoadResult` and is used by multiple commands. **Compliant**.

### Track B Readiness (Quick Check)

- Foundation is much closer than prior pass, but still not fully solid for Track B due to open prerequisite gaps:
  - `#1 (CC-03)` partial
  - `#42 (CC-16)` partial
  - `#44 (CC-19)` partial
- `#10 (C-8)` groundwork is present and strong.

## Gaps

- Parser contract consistency is incomplete for single-file loading pathways.
- Concept vocabulary validation pathway (`known_concepts`) is not fully wired.
- Severity model is only partially aligned with the Track A1 spec’s explicit field-level contract.
- One maintain test currently fails against the new severity behavior.

## Issues for Review Board Attention

1. **Track B prerequisite integrity:** confirm acceptable closure level for `#1`, `#42`, `#44` before green-lighting Track B.
2. **Severity policy intent:** validate whether maintain/check-links should treat broken dependencies as warnings or failures.
3. **Single-file parser error behavior:** verify whether current `load_frontmatter` contract is acceptable or needs harmonization with `load_documents`.
4. **Vocabulary validation wiring:** confirm intended source and propagation of `known_concepts`.

## Verdict

**Return to Developer**

The implementation is significantly improved and addresses most A1 items, but there are still foundational spec gaps in three prerequisite contracts (`#1`, `#42`, `#44`) plus an observable behavioral/test mismatch in maintain link-check severity.
