---
id: v3_3_track_b_review_consolidation
type: review
status: active
depends_on:
  - v3_3_track_b_peer_review
  - v3_3_track_b_alignment_review
  - v3_3_track_b_adversarial_review
  - v3_3_track_b_implementation_spec_v2
concepts:
  - v3.3b
  - track-b
  - consolidation
  - review-board
---

# v3.3 Track B Review Consolidation

## Outcome

Track B spec is revised and implementation-ready.

- Revised spec: `.ontos-internal/strategy/proposals/v3.3b/v3.3_Track_B_Implementation_Spec_v2.md`
- Consolidation artifact: `.ontos-internal/strategy/proposals/v3.3b/v3.3_Track_B_Review_Consolidation.md`

## 1. Finding Assessment Table

| Finding | Agree/Disagree | Accept for Revision? | Notes |
|---------|----------------|----------------------|-------|
| P-C1 Apply-mode `--json` contract missing | Agree | Yes | Added explicit apply-mode JSON schema with success/error/partial-commit payload. |
| P-C2 Parse-failure raw-scan semantics undefined | Agree | Yes | Added deterministic raw-scan algorithm for parse-failed files in link-check and rename pre-validation. |
| P-C3 Frontmatter patcher boundary mismatch (`.lstrip`) | Agree | Yes | Patcher now uses canonical-compatible preprocessing (BOM strip + `.lstrip()` + prefix-preserving reconstruction). |
| P-C4 Markdown link grammar incomplete | Agree | Yes | Added supported forms, parser requirements (balanced parens, escaped `\)`), and explicit unsupported forms. |
| P-M1 Clean-git guard blocks dry-run usability | Agree | Yes | Clean-git check moved to apply-mode only; dry-run allowed on dirty trees. |
| P-M2 Unsupported YAML detection undefined | Agree | Yes | Added deterministic unsupported-target-format rules + machine-readable reason payload schema. |
| P-M3 EOF rule for unclosed fences missing | Agree | Yes | Added explicit EOF behavior: remainder treated as `code_fence` (skipped). |
| P-M4 Scope migration notes missing | Agree | Yes | Added Section 3.5 migration notes with command-by-command old/new usage examples. |
| P-M5 A1 call points not operationalized | Agree | Yes | Added explicit selective validation call path and severity map wiring; prohibited `validate_all()` path for link-check. |
| P-Minor-1 `location` optionality unclear | Agree | Yes | JSON schema now uses `location: null` for frontmatter refs and documents required location fields for body refs. |
| P-Minor-2 Boundary punctuation rationale missing | Agree | Yes | Replaced with two-tier boundary model and added punctuation/table/blockquote vectors. |
| P-Minor-3 `--quiet` behavior unspecified | Agree | Yes | Added explicit quiet-mode semantics for both link-check and rename. |
| AL-C1 Bare-ID boundary usability concern | Agree | Yes | Resolved by two-tier boundary model (hard + trailing punctuation with lookahead). |
| AL-O1 JSON schema precedent for A3 | Partially Agree | No | Valid observation; tracked as A3 alignment concern, no Track B spec change required beyond current schemas. |
| A-CRIT-01 Boundary false negatives | Agree | Yes | Mandatory fix applied via two-tier boundary model and expanded corpus vectors. |
| A-CRIT-02 Cross-scope false broken links | Agree | Yes | Added external-ID secondary scan and `external_reference` classification in docs scope. |
| A-MAJ-01 YAML reserved words for `new_id` | Agree | Yes | Added reserved-word pre-validation (`true/false/yes/no/null/on/off`, case-insensitive). |
| A-MAJ-02 `.lstrip()` patcher mismatch | Agree | Yes | Same resolution as P-C3; canonical boundary parity now specified. |
| A-MAJ-03 Orphan scope semantics undefined | Agree | Yes | Defined scope-relative orphan semantics + external inbound adjustment + config-driven `allowed_orphan_types`. |
| A-MAJ-04 Markdown link title handling | Agree | Yes | Added title-aware supported syntax and parsing expectations. |
| A-MAJ-05 `validate_all()` vs selective validation ambiguity | Agree | Yes | Explicitly specifies selective validation calls and non-use of `validate_all()`. |
| A-MAJ-06 Cross-scope duplicate handling for rename | Partially Agree | Yes | Implemented stricter safety policy: abort docs-scope rename if `old_id`/`new_id` exists externally (instead of warn-only). |
| A-MAJ-07 `allowed_orphan_types` policy unspecified | Agree | Yes | Spec now binds link-check orphan policy to `config.validation.allowed_orphan_types` (map parity). |
| A-MIN-01 `old_id == new_id` friendly handling | Agree | Yes | Added explicit no-op pre-validation result. |
| A-MIN-02 `extract_doc_ids_from_text` supersession unclear | Partially Agree | Yes | Added constraint: Track B parsing must use `core/body_refs.py`; legacy helper remains out-of-scope. |
| A-MIN-03 `SessionContext.commit()` return-value cross-check | Agree | Yes | Added required commit-result vs plan cross-check and failure behavior. |
| A-MIN-04 Indented code block behavior unspecified | Partially Agree | Yes | Added explicit limitation: treated as `normal_text` in v3.3. |
| A-MIN-05 Stale VUL-07 note | Agree | Yes | Updated constraints to reflect A1 completion (no further Track B action). |
| A-MIN-06 `history.py` legacy parser interaction | Partially Agree | Yes | Added explicit note in constraints; no migration in Track B scope. |

## 2. Revised Spec Changes

| Change | Spec Section(s) | Triggered By |
|--------|------------------|--------------|
| Introduced two-tier boundary model (hard boundary + trailing punctuation lookahead) | 4.3 | AL-C1, P-Minor-2, A-CRIT-01 |
| Added punctuation/table/blockquote/dotted-ID boundary vectors | 4.3, 7 | A-CRIT-01, peer/adversarial test-gap notes |
| Added cross-scope external-ID resolution and `external_reference` classification | 4.2, 4.4, 4.5 | A-CRIT-02, P-M4 |
| Added parse-failed raw-scan candidate semantics for link-check | 4.2, 4.4 | P-C2, A-CRIT-02 |
| Added markdown grammar support/skip contract (titles, balanced parens, unsupported forms) | 4.3, 7 | P-C4, A-MAJ-04 |
| Added orphan semantics and config-bound `allowed_orphan_types` parity | 4.5 | A-MAJ-03, A-MAJ-07 |
| Added explicit selective validation path and severity map | 4.2 | P-M5, A-MAJ-05 |
| Added user-facing scope migration notes and old/new command examples | 3.5 | P-M4 |
| Added rename pre-validation: `old_id == new_id` no-op | 5.2, 5.7 | A-MIN-01 |
| Added rename pre-validation: `new_id` regex validation | 5.2 | A-MAJ-01 |
| Added rename pre-validation: YAML reserved-word rejection | 5.2 | A-MAJ-01 |
| Added rename docs-scope cross-scope guard (abort on external old/new collisions) | 5.2 | A-MAJ-06 |
| Moved clean-git check to apply-only | 5.2, 5.6, 7 | P-M1 |
| Added deterministic parse-failed raw guard scan for rename abort | 5.2 | P-C2 |
| Aligned frontmatter patcher with canonical preprocessing (`.lstrip()` + BOM) | 5.3 | P-C3, A-MAJ-02 |
| Added deterministic unsupported-target-format detection rules + warning payload schema | 5.3 | P-M2 |
| Added apply-mode JSON schema and contract rules | 5.5 | P-C1 |
| Added commit return cross-check (`modified_paths` vs plan) | 5.6 | A-MIN-03 |
| Added quiet-mode explicit behavior for both commands | 4.1, 5.1 | P-Minor-3 |
| Added JSON location nullability and external/parse-failed sections | 4.4 | P-Minor-1, A-CRIT-02 |
| Updated constraints for resolved VUL-07 and legacy helper scope | 9 | A-MIN-02, A-MIN-05 |
| Added note for `history.py` legacy parser non-migration | 9 | A-MIN-06 |
| Expanded parser/rename/link-check tests for new edge cases | 7 | peer/adversarial test gaps |

## 3. Final Readiness

Ready for implementation hand-off.

Blocking review concerns are resolved in spec text. Remaining open item is cross-track governance note (`AL-O1`) for Track A3 JSON harmonization, which is intentionally deferred out of Track B scope.
