# v3.0.5 Fix Summary — Antigravity

This document summarizes the fixes applied during Phase D.4, addressing the issues identified in `v3.0.5_Code_Review_Consolidation.md`.

## Fix Summary

| Issue | Status | Commit |
|-------|--------|--------|
| B1 | ✅ Fixed | `3ac6750` |
| B2 | ✅ Fixed | `3ac6750` |
| N1 | ✅ Fixed | `a6c86f0` |
| N2 | ✅ Fixed | `a6c86f0` |
| N3 | ✅ Fixed | `a6c86f0` |
| N4 | ✅ Fixed | `3ac6750` |
| N5 | ✅ Fixed | `3ac6750` |
| N6 | ✅ Fixed | `3ac6750` |

---

## Fixes Applied

### B1: Ctrl+C cleanup incomplete
- **Issue:** Cleanup only removed `.ontos.toml`, leaving directories and context map on abort.
- **Fix:** Updated `init_command` in `ontos/commands/init.py` to track all created paths and remove them in reverse order on `KeyboardInterrupt`.
- **Verification:** Manual Ctrl+C test + `test_ctrl_c_aborts_init_and_cleans_up`.

### B2: test_hook_collision_force_overwrites lacks assertions
- **Issue:** Test verified exit code but not actual content replacement.
- **Fix:** Added assertions to `tests/commands/test_init_phase3.py` to verify `ONTOS_HOOK_MARKER` is present and foreign content is absent.
- **Verification:** `pytest tests/commands/test_init_phase3.py`.

### N1: PR artifacts cleanup
- **Issue:** `pr_body.md` remained in the repo.
- **Fix:** Deleted `pr_body.md` and `pr_review_fixes_body.md`.
- **Verification:** `ls pr_body.md` returns error.

### N2: Roadmap table outdated
- **Issue:** Showed v3.0.4 as current.
- **Fix:** Updated `README.md` roadmap table to v3.0.5.
- **Verification:** Visual inspection of `README.md`.

### N3: TOC anchor link
- **Issue:** Anchor `#known-issues-v304` was outdated.
- **Fix:** Updated TOC in `README.md` to `#known-issues-v305`.
- **Verification:** Visual inspection of `README.md`.

### N4/N5/N6: Test Coverage
- **Issue:** Missing tests for EOF, TTY detection, and non-TTY paths.
- **Fix:** Added `test_ctrl_d_skips_hooks`, `test_non_tty_auto_installs_hooks`, and TTY-simulating cleanup tests.
- **Verification:** `pytest tests/commands/test_init_phase3.py` (20 passed).

---

## Verification
```bash
pytest tests/ -v
# Result: 429 passed, 2 skipped
```

**Ready for D.5: Codex Verification**
