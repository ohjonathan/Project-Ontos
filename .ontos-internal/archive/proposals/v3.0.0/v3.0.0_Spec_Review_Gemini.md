# v3.0.0 Spec Review: Peer Reviewer

**Your Role:** Peer Reviewer  
**Model:** Gemini 3.0 Pro  
**Focus:** Quality, completeness, clarity, implementability

---

## Context

The Chief Architect has written implementation specs for Ontos v3.0.0. This release solves the "activation problem" — Ontos works but LLMs can't find it because there are no instruction files (AGENTS.md, .cursorrules, etc.).

---

## Review Instructions

### Part 1: Completeness Check

For EACH sub-spec, verify:

| Sub-Spec | Has Requirements? | Has Technical Design? | Has Test Strategy? | Has Acceptance Criteria? | Implementable Without Questions? |
|----------|-------------------|----------------------|-------------------|-------------------------|----------------------------------|
| agents command | ✅ | ✅ | ✅ | ✅ | ✅ |
| PyPI publishing | ✅ | ✅ | ✅ | ✅ | ❌ (Missing verification) |
| Init exit code | ✅ | ✅ | ✅ | ✅ | ✅ |
| Init auto-gen | ✅ | ✅ | ✅ | ✅ | ✅ |
| Doctor staleness | ✅ | ✅ | ✅ | ✅ | ✅ |
| Data cleanup | ✅ | ✅ | ✅ | ✅ | ✅ |

**Note on PyPI:** The spec defines the workflow but lacks a *functional verification* step (smoke test) between TestPyPI and PyPI.

### Part 2: Quality Assessment

| Aspect | Rating | Notes |
|--------|--------|-------|
| Technical approach soundness | Adequate | The PyPI workflow is risky. It automates promotion to Prod based only on upload success, not installation success. |
| Spec clarity and precision | Good | Logic is explicit. Design choices (e.g., mtime checks, non-fatal init) are well-reasoned. |
| Test coverage adequacy | Good | Golden tests for generated files are a critical inclusion. |
| Error handling completeness | Good | Path safety and fallback behaviors are handled well. |
| Documentation plan | Good | Updates to README and Template content are clear. |

### Part 3: Open Questions Assessment

| Question | Spec Location | Your Research/Analysis | Recommendation | Confidence |
|----------|---------------|----------------------|----------------|------------|
| Q1: Keep `ontos export` as alias? | agents §10 | Removing aliases breaks existing user workflows. | **Keep as deprecated alias.** Add `DeprecationWarning` to stderr. | High |
| Q2: Add success signal to AGENTS.md? | agents §10 | LLMs often hallucinate success. Verification is better. | **Defer.** Rely on `ontos doctor` in Quick Reference. | High |
| Q3: Manual approval between TestPyPI and PyPI? | PyPI §10 | Trusted Publisher is secure but doesn't guarantee a working wheel. | **Automate but verify.** Add a workflow step: `pip install -i testpypi ontos && ontos --version`. | High |
| Q4: Logs dir default? | doctor §10 | Config is source of truth. Hardcoding breaks custom configs. | **Use config.** Fallback to `docs/logs` only if config fails. | High |
| Q5: Time-based staleness? | doctor §10 | Time-based is arbitrary. Mtime reflects actual changes. | **Reject.** Mtime (Space/Time ontology) is the correct heuristic. | High |

### Part 4: Template Content Review

**Evaluate the proposed template content (agents spec §5.2):**

| Aspect | Assessment |
|--------|------------|
| Will an LLM understand what Ontos is? | **Yes** ("This project uses Ontos...") |
| Will an LLM know how to activate? | **Yes** (Clear numbered steps) |
| Will an LLM remember to run `ontos log`? | **No** (LLMs struggle with deferred tasks. It needs to be an explicit "Protocol" or "Invariant".) |
| Is the Quick Reference sufficient? | **Yes** (Top 5 commands are correct) |
| What's missing that would help LLMs? | **Invariants.** (e.g., "Do not edit generated files", "Run doctor if unsure"). |

**What would make the AGENTS.md template more useful to you as an LLM?**
1.  **Explicit Invariants:** I need to know the rules. "Do not manually edit `Ontos_Context_Map.md`." "Always run `ontos doctor` before ending a session."
2.  **Context Pointer:** "Read `Ontos_Context_Map.md` to build your internal context graph." (Explain *why* I'm reading it).
3.  **Command Output Handling:** "If a command fails, read the error message; do not hallucinate a fix."

### Part 5: Issues Found

**Major (Should Fix Before Implementation):**

| # | Issue | Sub-Spec | Section | Suggestion |
|---|-------|----------|---------|------------|
| P-M1 | **Missing PyPI Functional Verification** | PyPI | 4.3.1 | Add a step between TestPyPI and PyPI: `pip install --index-url https://test.pypi.org/simple/ ontos` and run `ontos --version`. Ensures the wheel is valid before promoting. |
| P-M2 | **Staleness Logic Misses Package Updates** | Doctor | 4.3.1 | If I `pip install -U ontos`, the internal template changes, but `AGENTS.md` mtime is still fresh relative to `Context_Map`. The check should also compare `AGENTS.md` mtime against the `ontos` package installation time (or version). |

**Minor (Consider):**

| # | Issue | Sub-Spec | Section | Suggestion |
|---|-------|----------|---------|------------|
| P-m1 | **Cursorrules Path Ambiguity** | Agents | 5.1 | Spec says `ontos agents --format=cursor`. Does this write to `AGENTS.md`? Or `.cursorrules`? The design implies `.cursorrules` but should be explicit that the output filename changes based on format defaults. |
| P-m2 | **Output Directory Creation** | Agents | 3.2 | If I run `ontos agents -o new_dir/AGENTS.md`, does it create `new_dir`? Spec should clarify behavior (create parents or fail). |

### Part 6: Verdict

**Overall Assessment:** **Ready for implementation** (Conditional on PyPI verification)

**Recommendation:** **Approve with changes**

**Blocking Issues:** 0

**Top 3 Improvements:**
1.  **PyPI Smoke Test:** Add a `pip install` step in the release workflow to verify the artifact.
2.  **Template Invariants:** Add a "Core Invariants" section to `AGENTS.md` to prevent LLM misbehavior.
3.  **Doctor Precision:** Include `ontos` package version/date in the staleness comparison.
