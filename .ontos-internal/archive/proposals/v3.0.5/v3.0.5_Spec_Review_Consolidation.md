# v3.0.5 Spec Review Consolidation

**Project:** Ontos v3.0.5  
**Phase:** B.2 (Spec Review Consolidation)  
**Purpose:** Synthesize review board feedback on implementation spec  
**Date:** 2026-01-20

---

## Part 1: Verdict Summary

| Reviewer | Role | Verdict | Issues | Blocking? |
|----------|------|---------|--------|-----------|
| Gemini | Peer | Approve with changes | 1 Major, 2 Minor | No |
| Claude | Alignment | Approve with conditions | 2 Major, 2 Minor | No |
| Codex | Adversarial | Request changes | 2 Critical, 3 High | **Yes** |

**Consensus:** 2/3 Approve (with conditions)  
**Blocking issues:** 2 (Codex Critical)  
**Overall:** CA must respond first

---

## Part 2: Issues by Category

### Category A: Version Discrepancy

**Issue:** VER-1 sets `ONTOS_VERSION` to "3.0.4" but this is a v3.0.5 release.

| Reviewer | Flagged? | Severity | Assessment |
|----------|----------|----------|------------|
| Gemini | No | — | Not mentioned |
| Claude | Yes | Minor (A-m2) | Notes discrepancy, recommends update or explanation |
| Codex | Yes | **Critical (X-C1)** | "Version mismatch persists on release, undermining VER-1 intent" |

**Consolidation Assessment:**
- **Is this a real problem?** Yes. Releasing v3.0.5 with `ONTOS_VERSION="3.0.4"` immediately recreates the mismatch VER-1 was designed to fix.
- **What's the correct resolution?** Update to "3.0.5" in the spec.
- **Blocking?** **Yes** — This defeats the purpose of VER-1.

---

### Category B: MCP Warning Visibility

**Issue:** `FutureWarning` may not be visible to users in default warning filters.

| Reviewer | Flagged? | Severity | Assessment |
|----------|----------|----------|------------|
| Gemini | No | — | Notes `stacklevel=2` verification needed (P-m2) |
| Claude | No | — | Notes FutureWarning is "filterable" but acceptable |
| Codex | Yes | **Critical (X-C2)** | "Users still think `ontos[mcp]` is broken because they never see the warning" |

**Consolidation Assessment:**
- **Is this a real problem?** Partially. `FutureWarning` is suppressed by default in some contexts. However:
  - `FutureWarning` is semantically correct (feature coming in future)
  - `UserWarning` would be more visible but semantically incorrect
  - Import still succeeds; warning is informational
- **What's the correct resolution?** CA judgment call. Options:
  1. Keep `FutureWarning` (semantically correct, less visible)
  2. Use `UserWarning` (more visible, semantically wrong)
  3. Add verification note in spec about `stacklevel=2`
- **Blocking?** **No** — This is a judgment call, not a correctness issue.

---

### Category C: UX-1 Behavioral Semantics

**Issues flagged:**

| Sub-issue | Flagged By | Severity | Assessment |
|-----------|------------|----------|------------|
| Ctrl+C semantics (abort vs skip) | Codex (X-H3) | High | Ctrl+C swallowed → init continues. Usually means "abort." |
| Redirected stdin silent install | Codex (X-H2) | High | `isatty()` False auto-installs. Consent goal partially defeated. |
| Script/CI clarity | Codex (X-H1) | High | "Scripts need --yes" vs "non-TTY proceeds" is ambiguous |
| Terminology ("breaking change") | Claude (A-M2) | Major | Section 7.1 says "breaking change" but constraint says "no breaking changes" |

**Consolidation Assessment:**

**Ctrl+C semantics:**
- Current: Ctrl+C → "Skipping hooks" → init continues
- Expected by users: Ctrl+C → abort init entirely
- **Recommendation:** Decide intentionally. Either:
  - Abort init (user expectation) OR
  - Document clearly that Ctrl+C = decline hooks only
- **Blocking?** No, but should be decided and tested.

**Redirected stdin:**
- This is by design (non-TTY = automation = proceed)
- Codex's concern is valid for "accidental redirection" cases
- **Recommendation:** Accept current design; document in release notes
- **Blocking?** No.

**Script/CI clarity:**
- Spec says non-TTY proceeds, but also says "scripts need --yes"
- These only conflict for scripts run FROM a TTY
- **Recommendation:** Clarify in Section 7.1: "Scripts executed with TTY stdin need --yes"
- **Blocking?** No, but should be clarified.

**Terminology:**
- "Breaking change" in 7.1 contradicts "no breaking changes" constraint
- Actual change: additive consent prompt, not destructive
- **Recommendation:** Change "Breaking Change Note" → "Behavioral Change Note"
- **Blocking?** No.

---

### Category D: Test Coverage Gaps

**Issue:** Missing tests for edge cases.

| Reviewer | Flagged? | Severity | Assessment |
|----------|----------|----------|------------|
| Gemini | No | — | Considers tests adequate |
| Claude | No | — | Considers tests adequate |
| Codex | Yes | Multiple | Lists 10+ missing edge case tests |

**Codex's test gap list:**
- ❌ Ctrl+C during prompt
- ❌ Ctrl+D during prompt
- ❌ Prompt path parsing (TTY True)
- ❌ stdin redirected behavior
- ❌ Not in git repo
- ❌ Hooks dir missing / worktree
- ❌ Read-only hook file
- ❌ MCP warning visible by default

**Consolidation Assessment:**
- **Which are essential for v3.0.5?** 
  - Ctrl+C/D handling (if we decide semantics)
  - stdin redirected behavior
- **Which can be deferred?**
  - Non-git-repo, hooks dir missing, read-only file → existing code handles or should
  - MCP warning visibility → optional validation
- **Blocking?** No — Missing tests can be added during implementation.

---

### Category E: UX-1 Scope Expansion Verification

**Issue:** Claude notes UX-1 expanded significantly from triage.

| Reviewer | Flagged? | Severity | Assessment |
|----------|----------|----------|------------|
| Claude | Yes | Major (A-M1) | Requests CA confirm spec aligns with challenge resolution |

**Consolidation Assessment:**
- **Does the spec match the challenge resolution?** Yes — The triage challenge resolution explicitly approved:
  - Preflight message ✓
  - TTY confirmation prompt ✓
  - `--yes` flag ✓
  - Default = Yes ✓
  - Non-TTY proceeds ✓
- **Blocking?** No — This is process verification. CA can confirm.

---

### Category F: Implementation Details

Minor notes that don't affect spec validity:

| Issue | Flagged By | Action |
|-------|------------|--------|
| Missing `import sys` in snippet | Claude (A-m1) | Note: already imported in init.py |
| `stacklevel=2` verification | Gemini (P-m2), Codex | Verify during implementation |
| `getattr` vs direct access | Codex | Defensive; document or simplify |
| WRP-1 scratchpad location | Gemini (P-m1) | Optional: suggest file location |
| Preflight list hardcoded vs dynamic | Codex | Low risk; hooks are stable |

---

## Part 3: Reviewer Agreement Analysis

**Strong Agreement (All 3):**

| Topic | Consensus |
|-------|-----------|
| Spec is complete | All required elements present |
| VER-1, WRP-1, UX-2 are ready | Implementation-ready |
| UX-1 logic is sound | Consent flow handles TTY/flags correctly |
| Test class is appropriate | Three core tests cover main paths |

**Partial Agreement (2 of 3):**

| Topic | Agree | Disagree | Resolution |
|-------|-------|----------|------------|
| MCP-1 adequate | Gemini, Claude | Codex | CA judgment on warning class |
| Test coverage adequate | Gemini, Claude | Codex | Add Ctrl+C test if deciding semantics |
| Spec ready for implementation | Gemini, Claude | Codex | Address version issue first |

**Disagreement:**

| Topic | Gemini | Claude | Codex | Resolution |
|-------|--------|--------|-------|------------|
| VER-1 version target | Not mentioned | Flag as discrepancy | Critical blocker | **Update to 3.0.5** |
| MCP warning visibility | OK | OK | Critical | CA decides warning class |
| Ctrl+C semantics | Not mentioned | Not mentioned | High concern | CA decides and documents |

---

## Part 4: Blocking Issues Summary

| # | Issue | Flagged By | Why Blocking | Recommended Fix |
|---|-------|------------|--------------|-----------------|
| B1 | VER-1 targets "3.0.4" instead of "3.0.5" | Codex, Claude | Defeats purpose of VER-1 fix | Update spec to use "3.0.5" |

---

## Part 5: Non-Blocking Issues Summary

| # | Issue | Flagged By | Recommendation |
|---|-------|------------|----------------|
| N1 | MCP warning may be invisible | Codex | CA decides: FutureWarning vs UserWarning |
| N2 | Ctrl+C semantics unclear | Codex | Decide: abort init or skip hooks only |
| N3 | Terminology: "breaking change" | Claude | Change to "Behavioral Change Note" |
| N4 | Script/CI behavior ambiguous | Codex | Clarify: "TTY scripts need --yes" |
| N5 | UX-1 scope expansion unverified | Claude | CA confirms alignment with challenge resolution |
| N6 | `stacklevel=2` may be wrong | Gemini, Codex | Verify during implementation |
| N7 | Test for Ctrl+C behavior | Codex | Add if semantics are decided |

---

## Part 6: Action Items for Chief Architect

### Before Implementation (Blocking):

| # | Action | Addresses Issue | Effort |
|---|--------|-----------------|--------|
| 1 | Update VER-1 from "3.0.4" to "3.0.5" | B1 | Trivial |

### Recommended (Non-blocking):

| # | Action | Addresses Issue | Effort |
|---|--------|-----------------|--------|
| 1 | Confirm UX-1 spec aligns with challenge resolution | N5 | Trivial (statement) |
| 2 | Decide Ctrl+C semantics (abort vs skip) and document | N2 | Low |
| 3 | Change "Breaking Change Note" → "Behavioral Change Note" | N3 | Trivial |
| 4 | Clarify "scripts with TTY stdin need --yes" | N4 | Low |
| 5 | Decide on MCP warning class (FutureWarning vs UserWarning) | N1 | Trivial |

---

## Part 7: Spec Update Requirements

If CA accepts blocking issues:

| Section | Current | Required Change |
|---------|---------|-----------------|
| 3.1 VER-1 New Code | `ONTOS_VERSION = "3.0.4"` | `ONTOS_VERSION = "3.0.5"` |
| 9 Checklist item | Update to "3.0.4" | Update to "3.0.5" |
| 10 Commit message | "Sync legacy script version to 3.0.4" | "Sync legacy script version to 3.0.5" |

**Optional updates (if CA accepts recommendations):**

| Section | Current | Recommended Change |
|---------|---------|-----------------|
| 7.1 | "Breaking Change Note" | "Behavioral Change Note" |
| 7.1 | "scripts need `--yes`" | "scripts executed with TTY stdin need `--yes`" |
| 3.3.4 Ctrl+C handling | Prints "Skipping hooks." | *CA decides: abort or skip* |

---

## Part 8: Proceed Decision

**Recommendation:** CA Response Required

**Required Response:**
1. **VER-1 Update** — Confirm changing target to "3.0.5"
2. **UX-1 Confirmation** — Confirm spec matches challenge resolution (statement only)

**Optional Response (Recommended):**
3. **Ctrl+C Semantics** — Decide: abort init or skip hooks?
4. **Terminology** — Accept "Behavioral Change" rename?
5. **MCP Warning** — Keep FutureWarning or switch to UserWarning?

**After CA Response:**
- Update spec to v1.1
- Proceed to implementation

---

## Appendix: Codex Issue Calibration

Codex's "Fragile" overall rating and "Critical" severity on some issues requires calibration. Adversarial reviewers are designed to find edge cases.

| Codex Issue | Actual Severity for Patch | Reasoning |
|-------------|--------------------------|-----------|
| X-C1 (VER-1 version) | **Critical** — Agreed | Defeats fix purpose |
| X-C2 (MCP warning) | Medium | Judgment call, not correctness |
| X-H1 (Script clarity) | Low | Documentation polish |
| X-H2 (Redirected stdin) | Low | By design |
| X-H3 (Ctrl+C) | Medium | Real UX question, should decide |

**Conclusion:** Only X-C1 is truly blocking. Other issues are valid feedback for improvement but don't prevent implementation.

---

*Spec Review Consolidation — Phase B.2*
