---
id: v3_0_5_chief_architect_triage_response
type: decision
status: approved
depends_on: [v3_0_5_triage_review_consolidation]
concepts: [chief-architect-response, triage-response, blocking-challenge-resolution]
---

# v3.0.5 Chief Architect Triage Response

**Project:** Ontos v3.0.5
**Phase:** Pre-A (Triage Response)
**Purpose:** Address blocking challenge from review board
**Date:** 2026-01-20

---

## Part 1: Acknowledge the Challenge

| Question | Answer |
|----------|--------|
| Did you misunderstand the original finding? | **Yes.** I interpreted ChatGPT's concern as a documentation gap ("users can't find `--skip-hooks`"). The actual concern was silent repo mutation on first-run creating distrust. |
| Do you now understand the concern? | **Yes.** The issue is that `ontos init` installs git hooks without any warning or consent. Users discover their `.git/hooks/` directory has been modified only after the fact. This creates a trust deficit—especially for security-conscious users who scrutinize any tool touching their git config. Documentation doesn't fix this because the damage is done before users read docs. |

---

## Part 2: Decision

**Decision:** ACCEPT

---

## Part 3: Scope Change Details

**Scope Change:** UX-1 elevated from documentation-only to behavioral change.

**New Implementation:**

- [x] Print preflight message listing hooks before installation
- [x] Add TTY confirmation prompt: `Install git hooks? [Y/n]`
- [x] Support `--yes` flag for non-interactive mode
- [x] Retain existing `--skip-hooks` flag

**Effort Reassessment:** Trivial → **Low**

**Risk Assessment:**

| Risk | Level | Explanation |
|------|-------|-------------|
| Breaking change risk | **None** | Default answer is Yes; existing behavior preserved for users who press Enter |
| Backward compatibility | **Preserved** | Scripts using `ontos init` will need `--yes` flag, but this is expected for non-interactive use |
| Test burden | **Low** | Need tests for TTY vs non-TTY, `--yes` flag, `--skip-hooks` interaction |

---

## Part 4: Implementation Specification

### 4.1 New CLI Flag

Add to `ontos/cli.py` init subparser:
```python
p.add_argument("--yes", "-y", action="store_true",
               help="Non-interactive mode: accept all defaults")
```

### 4.2 Preflight Message

Before hook installation, print:
```
Git hooks to be installed:
  - pre-commit: Validates documentation before commits
  - pre-push: Ensures context map exists before push

Hooks location: .git/hooks/
Use --skip-hooks to skip installation.
```

### 4.3 TTY Confirmation Logic

In `ontos/commands/init.py`, before calling `_install_hooks()`:

```python
import sys

def _confirm_hooks(options: InitOptions) -> bool:
    """Confirm hook installation with user in TTY contexts."""
    if options.skip_hooks:
        return False  # User explicitly skipped
    if options.yes:
        return True   # Non-interactive mode
    if not sys.stdin.isatty():
        return True   # Non-TTY: proceed (CI/scripts)

    # Print preflight message
    print("\nGit hooks to be installed:")
    print("  - pre-commit: Validates documentation before commits")
    print("  - pre-push: Ensures context map exists before push")
    print("\nHooks location: .git/hooks/")
    print("Use --skip-hooks to skip installation.\n")

    try:
        response = input("Install git hooks? [Y/n] ").strip().lower()
        return response in ('', 'y', 'yes')
    except (EOFError, KeyboardInterrupt):
        print("\nSkipping hooks.")
        return False
```

### 4.4 Files to Modify

| File | Change |
|------|--------|
| `ontos/cli.py:108-110` | Add `--yes` flag to init subparser |
| `ontos/commands/init.py:23-74` | Add `_confirm_hooks()` function, call before `_install_hooks()` |
| `ontos/commands/init.py:17` | Add `yes: bool = False` to `InitOptions` dataclass |
| `tests/commands/test_init_phase3.py` | Add tests for confirmation flow |

### 4.5 Behavioral Matrix

| Context | `--yes` | `--skip-hooks` | stdin.isatty() | Behavior |
|---------|---------|----------------|----------------|----------|
| CI pipeline | No | No | False | Install hooks (no prompt) |
| CI pipeline | Yes | No | False | Install hooks (no prompt) |
| Terminal | No | No | True | **Prompt user** |
| Terminal | Yes | No | True | Install hooks (no prompt) |
| Terminal | No | Yes | True | Skip hooks |
| Any | Yes | Yes | Any | Skip hooks (`--skip-hooks` wins) |

---

## Part 5: Non-Blocking Items Response

| # | Recommendation | Response |
|---|----------------|----------|
| 1 | Clarify WRP-1: PYTHONPATH vs arg mismatch are separate issues | **Accept.** Will note in spec that testing should identify arg-passing bugs separately from import issues. |
| 2 | Correct CQ-6 rationale: stdlib-only design, not "PyYAML is used" | **Accept.** Rationale corrected: `serialize_frontmatter()` uses stdlib-only design per Constitution invariant #1. |
| 3 | Add CFG-1 runtime warning for wrapper commands | **Defer.** Runtime warnings in wrappers adds complexity; better to fix properly in v3.1 native migration. |
| 4 | Assign owner + decision date for STR-1, STR-2 | **Note.** Strategic items should be escalated to product owner with recommended decision date of v3.1 planning. |
| 5 | Consider accelerating MCP-2 to v3.2/v3.5; STR-3 is P1 for v3.1 | **Note.** MCP-2 acceleration and STR-3 priority noted for roadmap discussion. |

---

## Part 6: Updated v3.0.5 Scope Summary

| ID | Issue | Severity | Effort | Approach |
|----|-------|----------|--------|----------|
| VER-1 | Version string mismatch | High | Trivial | Update `_scripts/ontos_config_defaults.py:56` to "3.0.4" |
| MCP-1 | MCP extra is no-op | Medium | Low | Add import warning in `mcp/__init__.py` |
| **UX-1** | **Init hooks consent** | **Medium** | **Low** | **TTY confirmation prompt + preflight message + `--yes` flag** |
| UX-2 | Known Issues outdated | Medium | Low | Update README Known Issues for v3.0.4 reality |
| WRP-1 | Wrapper command testing | Medium | Medium | Test all wrappers, document limitations |

---

## Part 7: Verification Plan

1. **VER-1:** Run `ontos --version` and verify legacy scripts report correct version
2. **MCP-1:** Run `python -c "from ontos import mcp"` and verify warning emitted
3. **UX-1 (NEW):**
   - `ontos init` in TTY → verify preflight message + prompt appears
   - `ontos init --yes` → verify no prompt, hooks installed
   - `ontos init --skip-hooks` → verify no prompt, hooks skipped
   - `echo "" | ontos init` (non-TTY) → verify no prompt, hooks installed
   - `ontos init` then type `n` → verify hooks skipped
4. **UX-2:** Review README Known Issues matches implementation reality
5. **WRP-1:** Execute each wrapper command with representative args
6. **Full test suite:** `pytest tests/`

---

## Implementation Order

1. **VER-1** — Trivial, zero risk
2. **MCP-1** — Low effort, UX improvement
3. **UX-1** — Low effort, addresses blocking challenge
4. **WRP-1** — Medium effort, informs documentation
5. **UX-2** — Depends on WRP-1 findings

---

*Chief Architect Triage Response — v3.0.5*
