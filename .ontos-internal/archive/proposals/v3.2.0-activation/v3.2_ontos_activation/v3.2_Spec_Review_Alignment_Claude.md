---
id: v3_2_spec_review_alignment_claude
type: atom
status: complete
depends_on: [v3_2_ontos_activation_proposal]
concepts: [alignment, spec-review, philosophy, scope]
---

# v3.2 Ontos Activation — Spec Review (Alignment)

**Review signed by:**
- **Role:** Alignment Reviewer
- **Model:** Claude Opus 4.5
- **Date:** 2026-01-29
- **Review Type:** Spec Review (Proposal)

---

## Part 1: Philosophy Alignment

The proposal states this principle:

> **Key Principle:** Ontos manages **project context** (documentation, structure, knowledge graph), NOT **session context** (current task, decisions made).

**Reference:** From `philosophy.md`:
> "We will not silently record everything. Ontos requires intent because intent creates signal."
> "What you remember about the project is useless to your teammate... Ontos encodes knowledge at the repo level."

| Proposed Feature | Project Context? | Session Context? | Verdict |
|------------------|------------------|------------------|---------|
| AGENTS.md auto-sync | Yes | No | **Aligned** — syncs project stats (doc count, branch, health) |
| Tiered context map | Yes | No | **Aligned** — structures existing project docs |
| "Active Work" detection | Ambiguous | Ambiguous | **BORDERLINE** — see analysis below |
| "Current Project State" section | Yes | No | **Aligned** — branch, doc count, health are project state |
| Staleness detection | Yes | No | **Aligned** — already implemented in doctor.py:369 |

**Philosophy violations found:**

1. **"Active Work" terminology is problematic.** The proposal recommends detecting "active work" via:
   - Most recent logs (project context)
   - Documents with `status: in_progress` (project context)
   - Git branch + uncommitted changes (project context)

   The *data* is project context, but the *framing* as "active work" implies awareness of the current session's task. The language should be changed to "Recent Activity" or "Project Status" to avoid confusion.

---

## Part 2: Scope Boundary Check

The proposal explicitly excludes:
- Current task being worked on
- Decisions made during the session
- Work-in-progress state

| Feature | Creeps Into Excluded Scope? | Evidence |
|---------|----------------------------|----------|
| "Active Work" in Tier 1 | **YES** | Proposal line 299: "Add 'active work' detection" — term directly contradicts "work-in-progress state" exclusion |
| "Recent Activity" in AGENTS.md | No | Historical log data, not current task |
| "Last Log" tracking | No | Historical reference |
| Git branch detection | No | Repository state, not session state |

**Scope violations found:**

1. **Terminology mismatch:** The proposal excludes "work-in-progress state" (line 49) but then proposes "Active work detection" (line 299). These are linguistically indistinguishable. Either the exclusion should be narrowed or the feature renamed.

---

## Part 3: Tool-Agnostic Constraint

The proposal claims tool-agnostic design. Verification:

| Assumption | Tool-Agnostic? | Notes |
|------------|----------------|-------|
| Tools re-read AGENTS.md after compaction | **Unknown** | Proposal table (line 249-254) shows "Varies" for Gemini/Codex |
| Tiered context works with partial reads | Yes | Any tool can stop reading at any tier |
| `ontos map` available in all environments | Yes | CLI is portable |
| CLAUDE.md / .cursorrules pattern | **Risk** | Creates three files (AGENTS.md, CLAUDE.md, .cursorrules) with similar content |

**Tool-agnostic violations:**

1. **Unverified core assumption.** The proposal's effectiveness depends entirely on tools re-reading AGENTS.md after compaction. But the proposal admits:
   - Claude Code: Yes (every turn)
   - Cursor: Unknown
   - Gemini: Varies
   - Codex: Varies

   If tools don't re-read, the auto-sync provides no value. This should be tested before implementation.

2. **Fragmentation risk.** The proposal mentions CLAUDE.md is "kept minimal" while AGENTS.md has full instructions. This creates fragmentation where different tools get different information. The philosophy emphasizes "shared memory" but this creates tool-specific memory.

---

## Part 4: Consistency Check

Does this proposal contradict existing Ontos patterns?

| Existing Pattern | Proposal Consistent? | Notes |
|------------------|---------------------|-------|
| `ontos agents` creates AGENTS.md | **No** | Now `ontos map` also modifies it (line 126-136) |
| Context map is generated output | Yes | Tiering adds structure, doesn't change semantics |
| Doctor checks file health | Yes | Staleness check **already exists** (doctor.py:369) |
| Commands have single responsibility | **No** | `map` would now do two things: generate map AND sync AGENTS.md |

**Consistency violations:**

1. **Single-responsibility violation.** The proposal makes `map_command` call `agents_command` internally (line 126-136). This violates the current pattern where:
   - `ontos map` → generates context map (one thing)
   - `ontos agents` → generates instruction files (one thing)
   - `ontos doctor` → runs health checks (one thing)

   **Recommendation:** Instead of coupling commands, add a new `ontos sync` or `ontos activate` command that runs both. Or document the two-command workflow.

2. **Redundant implementation.** The staleness detection (Section 3.3) is already implemented in `doctor.py:369-453` as `check_agents_staleness()`. The proposal should reference this existing check, not propose it as new.

---

## Part 5: Backward Compatibility

| Change | Breaking? | Migration Needed? |
|--------|-----------|-------------------|
| New AGENTS.md format | **No** | Regenerate with `ontos agents --force` |
| Tiered context map structure | **No** | New structure is additive |
| Auto-sync behavior on `map` | **Surprising** | Users may not expect `map` to modify AGENTS.md |
| New doctor checks | **N/A** | Already implemented |

**Breaking changes identified:**

1. **Behavioral surprise.** Users who run `ontos map` expect only the context map to change. Auto-modifying AGENTS.md could cause unexpected diffs in version control. The proposal should:
   - Add `--no-sync` flag for opt-out
   - Or make sync opt-in via `--sync-agents`

---

## Part 6: Internal Consistency

Does the proposal contradict itself?

| Statement A | Statement B | Consistent? |
|-------------|-------------|-------------|
| "No session capture" (line 46) | "Active work detection" (line 299) | **No** |
| "Tool-agnostic" (line 68) | "CLAUDE.md kept minimal" (line 259) | Yes (but fragmentation risk) |
| "Zero manual steps" (line 388) | "Manual re-activation as fallback" (line 401) | **Contradictory** |
| "Sync only if exists" (Q1 rec, line 347) | "Zero manual steps" (success criteria, line 388) | **No** |

**Internal contradictions:**

1. **"No session capture" vs "Active work detection"** — These terms conflict. Either remove "active work detection" or clarify that it uses only project-level signals (logs, status fields).

2. **"Zero manual steps" is unachievable under recommended Option B.** If AGENTS.md doesn't exist, `ontos map` won't create it (per Q1 recommendation). This means users must manually run `ontos agents` first — a manual step.

3. **"Manual fallback" contradicts success criteria.** Success criteria #2 says "Zero manual steps" but Risk Mitigation mentions "Document manual re-activation as fallback" (line 401). These can't both be true.

---

## Part 7: Issues Found

### Critical (Alignment):

| # | Issue | Type | Why Critical |
|---|-------|------|--------------|
| A-C1 | "Active work detection" contradicts "no work-in-progress state" exclusion | Scope | Violates proposal's own stated boundary |
| A-C2 | `ontos map` calling `ontos agents` violates single-responsibility | Consistency | Breaks established command patterns |

### Major (Alignment):

| # | Issue | Type | Recommendation |
|---|-------|------|----------------|
| A-M1 | Tool-agnostic claim unverified | Constraint | Test whether Cursor/Gemini/Codex re-read AGENTS.md post-compaction |
| A-M2 | Staleness detection already exists | Redundancy | Reference existing `check_agents_staleness()` in doctor.py |
| A-M3 | "Zero manual steps" internally contradicted | Internal Consistency | Either create AGENTS.md by default or remove success criteria #2 |
| A-M4 | Behavioral surprise on `ontos map` | Backward Compatibility | Add `--no-sync` flag or make sync opt-in |

---

## Part 8: Uncomfortable Questions

**1. Is "active work detection" actually session context wearing project context clothing?**

**Answer: Partially yes.** The *data sources* (recent logs, in_progress status, git branch) are project context. But the *intent* — showing "what you're currently working on" — is session-oriented. The proposal should:
- Rename to "Recent Activity" or "Project Status"
- Clarify that this shows *historical* activity, not current session state

**2. Does auto-syncing AGENTS.md on `ontos map` violate single-responsibility?**

**Answer: Yes.** Currently:
- `map` → context map only
- `agents` → instruction files only
- `doctor` → health checks only

The proposal couples `map` and `agents`. Better alternatives:
- New `ontos sync` command that runs both
- New `ontos activate` command as single entry point
- Keep commands separate, document two-step workflow

**3. Is the proposal trying to solve a tooling problem (compaction recovery) with a documentation solution?**

**Answer: Yes, and this is acknowledged.** The proposal correctly notes (line 63):
> "Context compaction/recovery mechanics → **Tooling** (will improve over time)"

The proposal is a workaround for current tool limitations, not a fundamental Ontos capability. This is acceptable if framed as "bridge solution" rather than permanent feature.

**4. If tools don't re-read AGENTS.md after compaction, does this proposal accomplish anything?**

**Answer: Tiered context map still provides value.** Even without auto-sync, having Tier 1 (~2k tokens) means:
- Users can manually trigger re-activation with minimal token cost
- Tools that *do* re-read get fresh context
- The structure helps even without auto-sync

However, the auto-sync feature specifically becomes useless if tools don't re-read.

---

## Part 9: Verdict

**Alignment Status:** **Minor Deviations**

**Recommendation:** **Request changes**

**Blocking issues:** 2 (A-C1, A-C2)

**The proposal's relationship to Ontos's core purpose:**

This proposal **extends Ontos appropriately** in its core intent: making project context resilient across tool compaction. The tiered context map is a good structural improvement. The staleness detection is already implemented.

However, it **drifts in execution**:
1. The "active work" terminology blurs the project/session boundary
2. The command coupling (`map` → `agents`) violates established patterns
3. The success criteria ("zero manual steps") is internally contradicted

**Recommended changes before approval:**
1. Rename "Active Work" to "Recent Activity" throughout
2. Keep `map` and `agents` as separate commands; create new `ontos activate` if unified workflow desired
3. Remove redundant staleness detection proposal (already exists)
4. Reconcile success criteria #2 with Q1 recommendation Option B
5. Add `--no-sync` flag if auto-sync is implemented

---

## Appendix: Evidence References

- Philosophy violations: `philosophy.md` lines 93-98 ("Intent over automation")
- Existing staleness check: `doctor.py:369-453` (`check_agents_staleness`)
- Single-responsibility pattern: `map.py`, `agents.py`, `doctor.py` each do one thing
- Proposal's own exclusions: lines 46-51 ("What We Are NOT Solving")
