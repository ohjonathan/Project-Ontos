---
id: v3_2_re_architecture_ca_response
type: strategy
status: active
depends_on: [v3_2_re_architecture_support_proposal]
concepts: [migration, architecture, review-response]
---

# Chief Architect Response: v3.2 Re-Architecture Support Proposal

**Role:** Chief Architect (Claude Opus 4.5)
**Phase:** Pre-A — Proposal Review Response
**Date:** 2026-01-28
**Version:** 1.0

---

## 1. Review Summary

| Reviewer | Stance | Blocking Concerns | Key Theme |
|----------|--------|-------------------|-----------|
| Peer (Gemini) | **N/A** | 0 | Reviewed wrong document (interpreted as MCP/ODCS support protocol) |
| Alignment (Claude) | Concerns | 2 | Over-engineering; three commands violates "curation over ceremony" |
| Adversarial (ChatGPT) | Concerns | 3 | Heuristics unreliable; YAML promise not credible; needs explicit contracts |

**Consensus (Claude + ChatGPT):**
- Decision extraction via heuristics is the weakest part of the proposal
- Three commands is arguably too many for a single workflow
- The `export` rename creates a breaking change despite claiming "no breaking changes"
- The migration classification logic (safe/review/rewrite) is sound in principle

**Disagreement:**
- Claude: Drop decision extraction entirely; let AI agents do content analysis
- ChatGPT: Keep decision extraction but make decisions explicit via frontmatter fields or `ontos-decision` blocks

**Note on Gemini Review:** Gemini reviewed a different mental model (MCP-based support protocol routing). Their concerns about "Support Router" patterns, "Split-Brain State", and "Ticket Storms" don't apply to this proposal, which is about extracting existing documentation for migration. I'm setting this review aside.

---

## 2. Blocking Issues Response

### BLOCK-1: YAML Output Without Dependencies

**Raised by:** ChatGPT (Adversarial)

**Issue:** The proposal promises `--format yaml` output, but Python stdlib has no YAML serializer. Shipping a homegrown YAML emitter will break on edge cases (multiline, escaping, nested structures). This violates the Constitution's "Zero-Dependency" constraint.

**Response:** **ACCEPT**

**Reasoning:** This is factually correct. Python's stdlib includes `json` but not a YAML serializer. The Constitution states:
- "Zero-Dependency (V2.x): V2 tools must run on Python Standard Library (3.9+) ONLY"
- "System Package (V3.x): V3.0 moves logic to PyPI... This is the only time we introduce dependencies"

We cannot ship broken YAML output, and we haven't evaluated `pyyaml` as a dependency.

**Proposal Change:**
- Remove `--format yaml` from v3.2 scope
- JSON is the only output format for `export data`
- Add YAML as future work (v3.3+) when we properly evaluate adding `pyyaml` as optional dependency

**Open Question?** No. Decision made.

---

### BLOCK-2: Export Rename is a Breaking Change

**Raised by:** ChatGPT (Adversarial), Claude (Alignment)

**Issue:** Section 4.4 proposes renaming the current CLAUDE.md exporter and making bulk data export the primary `export` command. The proposal claims "Breaking Changes: None" — but renaming breaks existing scripts and agent prompts that call `ontos export`.

Claude adds: The confusion matrix is worse than acknowledged:
- `ontos agents` → generates AGENTS.md, .cursorrules
- `ontos export` (current) → generates CLAUDE.md
- `ontos export` (proposed) → extracts documents as JSON

These are three different things using overlapping terminology.

**Response:** **ACCEPT**

**Reasoning:** Both reviewers are correct. "No breaking changes" and "rename the existing command" are contradictory. The Impact Assessment is misleading.

**Proposal Change:** Adopt ChatGPT's subcommand approach:
```
ontos export data     # NEW - bulk data export
ontos export claude   # EXISTING - CLAUDE.md generation (moved)
ontos export          # DEPRECATED alias → warns and runs `export claude`
```

This preserves backward compatibility for one release cycle while creating a clear namespace for future export variants.

**Open Question?** No. Decision made.

---

### BLOCK-3: Decision Extraction Heuristics Will Fail

**Raised by:** ChatGPT (Adversarial), Claude (Alignment)

**Issue:** The `ontos decisions` command relies on finding markdown headers like "## Decision", "## Rationale", "## Alternatives Considered". But:

- Real decisions in logs are prose, not structured sections
- The finance-engine decisions cited ("Use 4999 not None") are buried in paragraphs
- The heuristics will produce noisy, incomplete results
- The mitigation ("add `decision_summary` field manually") contradicts "no schema changes"

**Response:** **PARTIALLY ACCEPT**

**Reasoning:** Both reviewers correctly identify that heuristic extraction is unreliable. But they propose different solutions:

- **Claude:** Drop extraction entirely. "Ontos provides structure; LLMs provide comprehension."
- **ChatGPT:** Keep it but make decisions explicit via frontmatter fields or fenced `ontos-decision` blocks.

I disagree with Claude's position. Ontos's value proposition is **deterministic, curated knowledge** — not "dump raw data and let the agent figure it out." If we can't deterministically extract decisions, we shouldn't pretend we can. But that doesn't mean we abandon the goal; it means we need explicit structure.

ChatGPT's explicit fields approach aligns with "curation over ceremony" — a small amount of ceremony (one frontmatter field) yields high-quality curation (real decisions, not guessed ones).

**Proposal Change:**
1. **Drop heuristic extraction from v3.2.** Remove `ontos decisions` command from this release.
2. **Add optional decision fields to frontmatter (no enforcement):**
   ```yaml
   decision_summary: "Use category_id 4999 for uncategorized transactions"
   alternatives_rejected:
     - option: "Use None"
       reason: "Downstream math fails on None"
   ```
3. **Export these fields in `ontos export data`** when present.
4. **Defer `ontos decisions` command to v3.3** after we have user feedback on field adoption.

**Open Question?** Yes — should we add `ontos-decision` fenced block syntax (ChatGPT's suggestion) in addition to frontmatter fields? Deferred to v3.3.

---

## 3. Major (Non-Blocking) Issues Response

| Issue | Raised By | Response | Action |
|-------|-----------|----------|--------|
| Three commands is two too many | Claude | **Partially Accept** | Reduce to 2 commands + 1 alias for v3.2 |
| No agent integration story | Claude | **Accept** | Add agent workflow section to docs; update AGENTS.md |
| Scope creep (this is v3.3+ work) | Claude | **Reject** | Migration classification is valuable; reduced scope addresses concerns |
| Filter expression is scope creep | ChatGPT | **Accept** | Drop `--filter` expression syntax; keep `--type/--status/--concept` |
| Migration classification too simplistic | ChatGPT | **Defer** | Valid, but typed edges require schema changes; add `migration_override` field as escape hatch |
| Golden tests will churn with timestamps | ChatGPT | **Accept** | Add `--deterministic` flag; document stable JSON ordering |
| Need internal "snapshot" primitive | ChatGPT | **Accept** | Good architecture; implement shared scanning/parsing layer |

---

## 4. Disputed Recommendations

### 4.1 Single Command vs. Multiple Commands

**Reviewer positions:**
- **Claude:** Single `ontos migrate` command. Migration is one intent, one action. Output folder with snapshot.json, analysis.md, checklist.md.
- **ChatGPT:** Neutral on count. Three commands are fine if architected around shared snapshot. Also proposes `ontos rearch pack` as orchestrator.

**CA Decision:** **Hybrid approach.**

Ship two commands in v3.2:
1. `ontos export data` — The foundational data snapshot
2. `ontos migration-report` — The dependency analysis (safe/review/rewrite)

Add a convenience alias:
```bash
ontos migrate
# Equivalent to: export data + migration-report → writes to ./migration/ folder
```

**Reasoning:** Users who say "help me migrate" want one command. Users scripting pipelines need composable pieces. The alias serves both without forcing a choice.

---

### 4.2 Decision Extraction: Drop vs. Explicit

**Reviewer positions:**
- **Claude:** Neither heuristics nor explicit fields. Don't extract at all. Let AI read raw content and summarize.
- **ChatGPT:** Explicit fields (`decision_summary`, `rationale`, `alternatives_rejected`) with optional fenced `ontos-decision` blocks.

**CA Decision:** **Explicit fields (optional), no heuristics.**

- Add optional frontmatter fields: `decision_summary`, `alternatives_rejected`
- Export these fields in `ontos export data` when present
- Do NOT add `ontos-decision` fenced blocks in v3.2 (adds parsing complexity)
- Do NOT build heuristic extraction

**Reasoning:** Explicit > inferred. If a decision is important enough to extract, the author should state it explicitly. This aligns with Ontos philosophy — the librarian curates what matters.

---

### 4.3 Migration Classification Simplicity

**Reviewer positions:**
- **ChatGPT:** The safe/review/rewrite classification is too simplistic. One leaky atom reference can mark half the graph as "Needs Review." Need typed edges (`depends_on` vs `references`) or migration-intent overrides.

**CA Decision:** **Add override field, defer typed edges.**

- Add `migration_status: safe|review|rewrite` override field to frontmatter
- If present, this overrides the graph-inferred classification
- Defer typed dependency edges to v3.3 (requires broader schema discussion)

**Reasoning:** The override field is a minimal, non-breaking escape hatch. Typed edges are the right long-term solution but require more planning.

---

## 5. Unresolved Questions

| Question | Why Unresolved | Needed to Resolve |
|----------|----------------|-------------------|
| `ontos-decision` fenced blocks? | Adds parsing complexity; may not be needed if frontmatter suffices | User feedback after v3.2 |
| Typed dependency edges? | Would solve "everything is review" problem but requires schema changes | v3.3 planning session |
| Agent protocol definition? | Need exact commands, artifacts, consumption pattern | Write before spec |
| MCP compatibility? | Out of scope for v3.2; important for v4.0 | Defer to roadmap |

---

## 6. Proposal Status

**Current State:** **Needs Revision**

### Required Changes Before Spec:

- [ ] Remove `--format yaml` (JSON only)
- [ ] Fix export namespace: `export data` / `export claude` subcommands
- [ ] Remove `ontos decisions` command from v3.2 scope
- [ ] Add optional frontmatter fields: `decision_summary`, `alternatives_rejected`
- [ ] Add optional frontmatter field: `migration_status: safe|review|rewrite`
- [ ] Remove `--filter` expression syntax
- [ ] Add `--deterministic` flag for testing
- [ ] Add `ontos migrate` as convenience alias
- [ ] Implement shared snapshot primitive (internal architecture)
- [ ] Write agent workflow protocol section
- [ ] Update AGENTS.md template with migration commands

### Files to Update:

1. `v3.2_Re-Architecture_Support_Proposal.md` — Apply all changes above
2. `docs/reference/Ontos_Agent_Instructions.md` — Add "Migrate Ontos" workflow
3. AGENTS.md template — Add migration protocol

---

## 7. Revised Command Structure (v3.2)

```bash
# Bulk data export (NEW)
ontos export data -o snapshot.json
ontos export data --type strategy,product -o filtered.json
ontos export data --no-content -o index.json
ontos export data --deterministic -o test-fixture.json

# CLAUDE.md generation (EXISTING, moved to subcommand)
ontos export claude
ontos export claude --force

# Backward compatibility (DEPRECATED, prints warning)
ontos export
# → "Deprecation warning: Use 'ontos export claude' or 'ontos export data'"

# Migration analysis (NEW)
ontos migration-report
ontos migration-report -o analysis.md
ontos migration-report --format json -o analysis.json

# Convenience command (NEW, runs both)
ontos migrate
ontos migrate -o ./migration/
# Creates: migration/snapshot.json, migration/analysis.md
```

---

## 8. Next Steps

1. **Revise proposal document** with all changes above
2. **Write agent workflow protocol section** before spec
3. **Re-submit for single reviewer** (scope reduction warrants lighter review)
4. **Move to implementation spec** if no new blocking issues

---

**Signed:** Claude Opus 4.5, Chief Architect
**Date:** 2026-01-28
