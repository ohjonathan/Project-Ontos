---
id: ontos_technical_architecture
type: atom
status: active
depends_on: [ontos_strategy]
---

# Project Ontos: Technical Architecture

*Documented: December 2025*

<!-- NOTE: When releasing Ontos 2.0, archive this file as Ontos_1.0_Technical_Architecture.md and create a fresh Ontos_Technical_Architecture.md -->

---

## 1. Architecture Overview

### 1.1 Design Principles

Ontos follows three architectural principles derived from the project strategy:

| Principle | Implementation |
|-----------|----------------|
| **LLM-powered generation, deterministic validation** | AI agents handle tagging and summarization; Python scripts validate correctness |
| **Lightweight over complex** | No database, no server, no build step—just Python scripts and markdown files |
| **Explicit over magic** | Agents declare what context they load; no automatic injection |

### 1.2 System Boundaries

```
┌─────────────────────────────────────────────────────────────────────┐
│                         USER'S PROJECT                              │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌──────────────┐    ┌──────────────┐    ┌──────────────────────┐  │
│  │   docs/      │    │   .ontos/    │    │  Ontos_Context_Map.md│  │
│  │  (markdown   │───▶│  (scripts)   │───▶│  (generated output)  │  │
│  │   files)     │    │              │    │                      │  │
│  └──────────────┘    └──────────────┘    └──────────────────────┘  │
│         │                   │                       │               │
│         │                   │                       │               │
│         ▼                   ▼                       ▼               │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │                      AI AGENT                                 │  │
│  │  - Reads context map                                         │  │
│  │  - Loads relevant files                                      │  │
│  │  - Updates frontmatter                                       │  │
│  │  - Runs validation scripts                                   │  │
│  └──────────────────────────────────────────────────────────────┘  │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

**Key insight:** Ontos is not a runtime system. It's a documentation protocol with validation tooling. The "runtime" is whatever AI agent the user invokes.

---

## 2. Directory Structure

### 2.1 Ontos Installation Layout

```
project-root/
├── .ontos/
│   ├── scripts/
│   │   ├── ontos_config.py              # User configuration (never auto-updated)
│   │   ├── ontos_config_defaults.py     # Default settings (auto-updated)
│   │   ├── ontos_generate_context_map.py
│   │   ├── ontos_migrate_frontmatter.py
│   │   ├── ontos_end_session.py
│   │   ├── ontos_update.py
│   │   ├── ontos_install_hooks.py
│   │   └── ontos_remove_frontmatter.py
│   ├── hooks/
│   │   └── pre-push                     # Git hook source
│   └── backups/                         # Created by update script
├── docs/
│   ├── kernel/                          # Optional: organize by type
│   ├── strategy/
│   ├── product/
│   ├── atom/
│   ├── logs/                            # Session logs
│   └── _template.md                     # Frontmatter template
├── Ontos_Context_Map.md                 # Generated artifact
├── Ontos_Agent_Instructions.md          # Copied from docs/reference/ during install
└── .git/hooks/
    └── pre-push                         # Installed hook
```

### 2.2 File Responsibilities

| File | Purpose | Mutability |
|------|---------|------------|
| `ontos_config.py` | User customizations | User-editable, never auto-updated |
| `ontos_config_defaults.py` | Shipped defaults | Auto-updated by `ontos_update.py` |
| `Ontos_Context_Map.md` | Generated graph view | Regenerated on each run; never edit manually |
| `Ontos_Agent_Instructions.md` | Protocol for AI agents | Copied from `docs/reference/` during install |
| `docs/**/*.md` | Source documentation | User-maintained with YAML frontmatter |
| `docs/logs/*.md` | Session archives | Generated by `ontos_end_session.py`, then edited |
| `docs/reference/Ontos_*.md` | Ontos documentation source | Updated by `ontos_update.py` |

---

## 3. Data Model

### 3.1 YAML Frontmatter Schema

Every Ontos-tracked document begins with YAML frontmatter:

```yaml
---
id: unique_snake_case_id    # REQUIRED. Stable identifier. Never change.
type: atom                   # REQUIRED. One of: kernel, strategy, product, atom
status: active               # OPTIONAL. One of: draft, active, deprecated
owner: null                  # OPTIONAL. Role responsible for this document
depends_on:                  # OPTIONAL. List of dependency IDs
  - parent_doc_id
  - another_dependency
---
```

### 3.2 Type Hierarchy

Types form a ranked hierarchy. Dependencies must flow **down** (toward stability):

```
        ┌─────────┐
        │ kernel  │  Rank 0 - Most stable (mission, values, principles)
        │         │
        └────┬────┘
             │
        ┌────▼────┐
        │strategy │  Rank 1 - Business decisions (goals, roadmap, audience)
        │         │
        └────┬────┘
             │
        ┌────▼────┐
        │ product │  Rank 2 - User-facing specs (features, flows, requirements)
        │         │
        └────┬────┘
             │
        ┌────▼────┐
        │  atom   │  Rank 3 - Implementation details (API, schemas, configs)
        │         │
        └─────────┘
             │
        ┌────▼────┐
        │ unknown │  Rank 4 - Unclassified (normalized from null/invalid)
        └─────────┘
```

**Dependency rule:** A document can only depend on documents of equal or lower rank (higher stability).

- ✅ `atom` → `product` → `strategy` → `kernel`
- ❌ `kernel` → `atom` (architectural violation)

### 3.3 Type Definitions (Source of Truth)

From `ontos_config_defaults.py`:

```python
TYPE_DEFINITIONS = {
    'kernel': {
        'rank': 0,
        'definition': 'Immutable foundational principles that rarely change',
        'signals': ['mission', 'values', 'philosophy', 'principles']
    },
    'strategy': {
        'rank': 1,
        'definition': 'High-level decisions about goals, audiences, approaches',
        'signals': ['goals', 'roadmap', 'monetization', 'target market']
    },
    'product': {
        'rank': 2,
        'definition': 'User-facing features, journeys, requirements',
        'signals': ['user flow', 'feature spec', 'requirements', 'user story']
    },
    'atom': {
        'rank': 3,
        'definition': 'Technical implementation details and specifications',
        'signals': ['API', 'schema', 'config', 'implementation', 'technical spec']
    },
    'unknown': {
        'rank': 4,
        'definition': 'Unclassified document type',
        'signals': []
    }
}
```

### 3.4 Normalization Rules

YAML frontmatter can contain null, empty, or malformed values. The system normalizes these:

| Field | Input | Normalized Output |
|-------|-------|-------------------|
| `depends_on` | `null`, empty, or missing | `[]` (empty list) |
| `depends_on` | `"single_id"` (string) | `["single_id"]` (list) |
| `depends_on` | `[null, "valid", ""]` | `["valid"]` (filtered) |
| `type` | `null`, empty, or invalid | `"unknown"` |
| `type` | `"kernel \| strategy"` (with pipe) | `"unknown"` |
| `status` | `null` or empty | `"unknown"` |
| `id` | `null`, empty, or whitespace | Document skipped entirely |

---

## 4. Script Architecture

### 4.1 Script Dependency Graph

```
ontos_config_defaults.py ◄─────────────────────────────────────┐
         │                                                      │
         ▼                                                      │
ontos_config.py ◄──────────────────────────────────────────────┤
         │                                                      │
         ├──────────────┬──────────────┬──────────────┐        │
         ▼              ▼              ▼              ▼        │
  generate_       migrate_        end_session.py   remove_     │
  context_map.py  frontmatter.py                   frontmatter │
                                                      .py      │
                                                               │
                                            ontos_update.py ───┘
                                            (updates defaults)
```

All scripts import configuration from `ontos_config.py`, which itself imports defaults from `ontos_config_defaults.py`.

### 4.2 Core Scripts

#### `ontos_generate_context_map.py`

**Purpose:** Scan documentation, build dependency graph, validate integrity, generate context map.

**Input:** Markdown files in configured `DOCS_DIR`

**Output:** `Ontos_Context_Map.md`

**Key Functions:**

| Function | Responsibility |
|----------|----------------|
| `parse_frontmatter(filepath)` | Extract YAML from markdown file |
| `normalize_depends_on(value)` | Handle null/string/list edge cases |
| `normalize_type(value)` | Handle null/invalid type values |
| `scan_docs(root_dirs)` | Walk directories, collect document metadata |
| `generate_tree(files_data)` | Create hierarchical text representation |
| `validate_dependencies(files_data)` | Run all five integrity checks |
| `generate_context_map(target_dirs)` | Orchestrate full generation |
| `watch_mode(target_dirs)` | File watcher for development |

**CLI Interface:**

```bash
python3 ontos_generate_context_map.py [OPTIONS]

Options:
  --dir DIR        Directory to scan (repeatable)
  --strict         Exit with code 1 if issues found
  --quiet, -q      Suppress non-error output
  --watch, -w      Watch for changes and regenerate
  --version, -V    Show version
```

#### `ontos_migrate_frontmatter.py`

**Purpose:** Identify untagged files and generate a prompt for AI-assisted tagging.

**Input:** Markdown files without YAML frontmatter

**Output:** `migration_prompt.txt` containing file list and tagging instructions

**Key Functions:**

| Function | Responsibility |
|----------|----------------|
| `has_frontmatter(filepath)` | Check if file starts with `---` |
| `scan_for_untagged_files(root_dir)` | Find all markdown files missing frontmatter |
| `generate_taxonomy_table()` | Create type reference from `TYPE_DEFINITIONS` |
| `generate_prompt(files)` | Build structured prompt for AI agent |

**CLI Interface:**

```bash
python3 ontos_migrate_frontmatter.py [OPTIONS]

Options:
  --dir DIR        Directory to scan
  --strict         Exit with code 1 if untagged files found
  --quiet, -q      Suppress output
  --dry-run        Preview without writing prompt file
```

#### `ontos_end_session.py`

**Purpose:** Create session log scaffold with git history, optionally add changelog entry.

**Input:** Topic slug, optional source name

**Output:** Session log file in `docs/logs/`, optional `CHANGELOG.md` entry

**Key Functions:**

| Function | Responsibility |
|----------|----------------|
| `validate_topic_slug(slug)` | Enforce naming rules for filenames |
| `find_last_session_date()` | Locate most recent log for git diff |
| `get_session_git_log()` | Extract commits since last session |
| `create_log_file(topic_slug, source)` | Generate log scaffold |
| `find_changelog()` | Locate project's CHANGELOG.md |
| `add_changelog_entry(category, description)` | Insert entry under [Unreleased] |

**CLI Interface:**

```bash
python3 ontos_end_session.py TOPIC [OPTIONS]

Arguments:
  TOPIC            Session slug (e.g., "auth-refactor")

Options:
  --source, -s     LLM/tool name (e.g., "Claude Code")
  --changelog, -c  Prompt for changelog entry
  --quiet, -q      Suppress output
```

#### `ontos_update.py`

**Purpose:** Pull latest Ontos from GitHub, update scripts and docs while preserving user config.

**Input:** GitHub repository (https://github.com/ohjona/project-ontos)

**Output:** Updated scripts in `.ontos/scripts/`, backups in `.ontos/backups/`

**Key Functions:**

| Function | Responsibility |
|----------|----------------|
| `clone_latest(temp_dir)` | Shallow clone from GitHub |
| `get_remote_version(temp_dir)` | Extract version from cloned repo |
| `backup_file(filepath, backup_dir)` | Create `.bak` copy before overwriting |
| `update_scripts(temp_dir)` | Copy updatable scripts |
| `update_docs(temp_dir)` | Copy documentation files |
| `update_hooks(temp_dir)` | Copy and chmod hook files |

**Protected files (never overwritten):**
- `ontos_config.py`

**CLI Interface:**

```bash
python3 ontos_update.py [OPTIONS]

Options:
  --check, -c      Only check for updates, don't apply
  --dry-run, -n    Preview what would change
  --force, -f      Update even if versions match
  --scripts-only   Only update scripts
  --docs-only      Only update documentation
```

#### `ontos_install_hooks.py`

**Purpose:** Install git hooks from `.ontos/hooks/` to `.git/hooks/`.

**Key Functions:**

| Function | Responsibility |
|----------|----------------|
| `find_project_root()` | Walk up to find `.git` directory |
| `install_hook(src, dest)` | Copy hook file and set executable bit |

#### `ontos_remove_frontmatter.py`

**Purpose:** Strip YAML frontmatter from files (for uninstallation or cleanup).

**Key Functions:**

| Function | Responsibility |
|----------|----------------|
| `remove_frontmatter(filepath)` | Parse and remove `---` delimited header |
| `scan_for_tagged_files(root_dir)` | Find all files with frontmatter |

---

## 5. Validation Algorithms

### 5.1 Five Integrity Checks

The `validate_dependencies()` function performs five checks:

```
┌─────────────────────────────────────────────────────────────────┐
│                    VALIDATION PIPELINE                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  1. BROKEN LINKS                                                │
│     For each depends_on ID, verify target exists                │
│     Output: [BROKEN LINK] doc_a references missing ID: doc_b    │
│                                                                 │
│  2. CYCLE DETECTION (DFS)                                       │
│     Depth-first search with recursion stack                     │
│     Output: [CYCLE] Circular dependency: a -> b -> a            │
│                                                                 │
│  3. ORPHAN DETECTION                                            │
│     Find docs with no incoming edges (no dependents)            │
│     Exceptions: kernel, strategy, product types; /logs/ dir     │
│     Output: [ORPHAN] doc_a has no dependents                    │
│                                                                 │
│  4. DEPENDENCY DEPTH                                            │
│     Memoized depth calculation per node                         │
│     Default max: 5 levels                                       │
│     Output: [DEPTH] doc_a has depth 7 (max: 5)                  │
│                                                                 │
│  5. ARCHITECTURAL VIOLATIONS                                    │
│     Compare type ranks: dependent must be >= dependency         │
│     Output: [ARCHITECTURE] kernel depends on atom               │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 5.2 Cycle Detection Algorithm

Uses depth-first search with a recursion stack to detect back edges:

```python
def detect_cycle(node, path):
    visited.add(node)
    recursion_stack.add(node)
    path.append(node)
    
    for neighbor in adj[node]:
        if neighbor not in visited:
            if detect_cycle(neighbor, path):
                return True
        elif neighbor in recursion_stack:
            # Back edge found - cycle detected
            cycle_path = path[path.index(neighbor):] + [neighbor]
            report_cycle(cycle_path)
            return True
    
    recursion_stack.remove(node)
    path.pop()
    return False
```

**Time complexity:** O(V + E) where V = documents, E = dependencies

### 5.3 Depth Calculation

Uses memoization to avoid recomputation:

```python
def get_depth(node):
    if node in memo:
        return memo[node]
    
    if not adj[node]:  # No dependencies
        return 0
    
    memo[node] = 0  # Prevent infinite recursion in cycles
    max_depth = max(get_depth(dep) for dep in adj[node])
    memo[node] = 1 + max_depth
    return memo[node]
```

### 5.4 Skip Patterns

Certain files are excluded from validation:

| Pattern | Reason |
|---------|--------|
| `_template.md` | Internal templates |
| `Ontos_*` | Ontos tooling files |
| `/logs/` directory | Session logs are intentionally standalone |
| IDs starting with `_` | Internal/template documents |

---

## 6. Data Flow

### 6.1 Activation Flow ("Ontos")

```
User: "Ontos"
    │
    ▼
┌─────────────────────────────────────┐
│ Agent checks for Ontos_Context_Map  │
└─────────────────┬───────────────────┘
                  │
        ┌─────────┴─────────┐
        │                   │
        ▼                   ▼
    [EXISTS]            [MISSING]
        │                   │
        │                   ▼
        │         ┌─────────────────────┐
        │         │ Run generate script │
        │         └─────────┬───────────┘
        │                   │
        ◄───────────────────┘
        │
        ▼
┌─────────────────────────────────────┐
│ Agent reads Ontos_Context_Map.md    │
└─────────────────┬───────────────────┘
                  │
                  ▼
┌─────────────────────────────────────┐
│ Agent identifies relevant doc IDs   │
│ based on user's request             │
└─────────────────┬───────────────────┘
                  │
                  ▼
┌─────────────────────────────────────┐
│ Agent reads ONLY those files        │
└─────────────────┬───────────────────┘
                  │
                  ▼
┌─────────────────────────────────────┐
│ Agent confirms: "Loaded: [id1, id2]"│
└─────────────────────────────────────┘
```

### 6.2 Archival Flow ("Archive Ontos")

```
User: "Archive Ontos"
    │
    ▼
┌─────────────────────────────────────┐
│ Agent runs generate script          │
│ (ensures graph is clean)            │
└─────────────────┬───────────────────┘
                  │
                  ▼
┌─────────────────────────────────────┐
│ Agent runs end_session.py           │
│ with topic slug and --source        │
└─────────────────┬───────────────────┘
                  │
                  ▼
┌─────────────────────────────────────┐
│ Script creates scaffold in          │
│ docs/logs/YYYY-MM-DD_topic.md       │
│ with git log since last session     │
└─────────────────┬───────────────────┘
                  │
                  ▼
┌─────────────────────────────────────┐
│ Agent reads scaffold, fills in:     │
│ - Goal                              │
│ - Key Decisions                     │
│ - Changes Made                      │
│ - Next Steps                        │
└─────────────────┬───────────────────┘
                  │
                  ▼
┌─────────────────────────────────────┐
│ Agent commits log file              │
└─────────────────────────────────────┘
```

### 6.3 Maintenance Flow ("Maintain Ontos")

```
User: "Maintain Ontos"
    │
    ▼
┌─────────────────────────────────────┐
│ Agent runs migrate_frontmatter.py   │
│ to find untagged files              │
└─────────────────┬───────────────────┘
                  │
        ┌─────────┴─────────┐
        │                   │
        ▼                   ▼
   [UNTAGGED]           [ALL TAGGED]
        │                   │
        ▼                   │
┌───────────────────┐       │
│ Agent tags files  │       │
│ with frontmatter  │       │
└─────────┬─────────┘       │
          │                 │
          ◄─────────────────┘
          │
          ▼
┌─────────────────────────────────────┐
│ Agent runs generate_context_map.py  │
└─────────────────┬───────────────────┘
                  │
        ┌─────────┴─────────┐
        │                   │
        ▼                   ▼
   [ISSUES]             [CLEAN]
        │                   │
        ▼                   │
┌───────────────────┐       │
│ Agent fixes:      │       │
│ - Broken links    │       │
│ - Cycles          │       │
│ - Violations      │       │
└─────────┬─────────┘       │
          │                 │
          ◄─────────────────┘
          │
          ▼
┌─────────────────────────────────────┐
│ Agent commits updated context map   │
└─────────────────────────────────────┘
```

---

## 7. Configuration System

### 7.1 Two-File Architecture

```
ontos_config_defaults.py          ontos_config.py
┌─────────────────────────┐      ┌─────────────────────────┐
│ # Shipped defaults      │      │ # User overrides        │
│ # AUTO-UPDATED          │      │ # NEVER AUTO-UPDATED    │
│                         │      │                         │
│ ONTOS_VERSION = '1.4.1' │      │ from ontos_config_      │
│                         │      │   defaults import *     │
│ DEFAULT_DOCS_DIR = 'docs'      │                         │
│ DEFAULT_LOGS_DIR =      │      │ # Override defaults:    │
│   'docs/logs'           │◄─────│ DOCS_DIR = 'documents'  │
│ DEFAULT_MAX_DEPENDENCY_ │      │ SKIP_PATTERNS += [      │
│   DEPTH = 5             │      │   'drafts/'             │
│                         │      │ ]                       │
│ TYPE_DEFINITIONS = {...}│      │                         │
└─────────────────────────┘      └─────────────────────────┘
```

**Rationale:** Users can customize without forking. Updates pull new defaults without clobbering customizations.

### 7.2 Configuration Variables

| Variable | Default | Purpose |
|----------|---------|---------|
| `DOCS_DIR` | `'docs'` | Root directory for documentation |
| `LOGS_DIR` | `'docs/logs'` | Directory for session logs |
| `CONTEXT_MAP_FILE` | `'Ontos_Context_Map.md'` | Output file path |
| `MAX_DEPENDENCY_DEPTH` | `5` | Maximum allowed chain depth |
| `ALLOWED_ORPHAN_TYPES` | `['product', 'strategy', 'kernel']` | Types exempt from orphan check |
| `SKIP_PATTERNS` | `['_template.md', 'Ontos_']` | Files to ignore during scanning |

### 7.3 Project Root Detection

Scripts auto-detect project root by walking up from the script location:

```python
def find_project_root():
    current = os.path.dirname(os.path.abspath(__file__))
    while True:
        if os.path.isdir(os.path.join(current, '.ontos')):
            return current
        parent = os.path.dirname(current)
        if parent == current:
            return os.getcwd()
        current = parent
```

---

## 8. Integration Points

### 8.1 CI/CD Integration

**GitHub Actions example:**

```yaml
- name: Validate Ontos Graph
  run: python3 .ontos/scripts/ontos_generate_context_map.py --strict --quiet
```

The `--strict` flag causes exit code 1 on any validation issue, failing the pipeline.

### 8.2 Pre-commit Hook

```yaml
# .pre-commit-config.yaml
repos:
  - repo: local
    hooks:
      - id: ontos-validate
        name: Validate Ontos Context Map
        entry: python3 .ontos/scripts/ontos_generate_context_map.py --strict --quiet
        language: system
        pass_filenames: false
        always_run: true
```

### 8.3 Pre-push Hook

The pre-push hook reminds users to archive sessions:

```bash
#!/bin/bash
# Check if session log exists for today
TODAY=$(date +%Y-%m-%d)
TODAY_LOG=$(ls docs/logs/${TODAY}_*.md 2>/dev/null | head -1)

if [ -z "$TODAY_LOG" ]; then
    echo "No session log created today."
    echo "Consider running 'Archive Ontos' before pushing."
    read -p "Continue anyway? [y/n]: " choice
    # ...
fi
```

### 8.4 Agent Integration

Agents integrate via the protocol defined in `Ontos_Agent_Instructions.md`:

| Trigger | Agent Action |
|---------|--------------|
| "Ontos" / "Activate Ontos" | Read map, load relevant context, confirm |
| "Archive Ontos" | Final polish, create log, fill summary, commit |
| "Maintain Ontos" | Tag files, regenerate map, fix issues, commit |
| "Update Ontos" | Run update script, report version change |

---

## 9. Error Handling

### 9.1 File System Errors

All file operations use specific exception handling:

```python
try:
    with open(filepath, 'w', encoding='utf-8') as f:
        f.write(content)
except (IOError, OSError, PermissionError) as e:
    print(f"Error: Failed to write {filepath}: {e}")
    return ""
```

### 9.2 YAML Parsing Errors

Invalid YAML is caught and reported without crashing:

```python
try:
    frontmatter = yaml.safe_load(parts[1])
    return frontmatter
except yaml.YAMLError as e:
    print(f"Error parsing YAML in {filepath}: {e}")
    return None
```

### 9.3 Encoding Handling

Files are read with UTF-8 encoding and error replacement:

```python
with open(filepath, 'r', encoding='utf-8', errors='replace') as f:
    content = f.read()
```

---

## 10. Testing Architecture

### 10.1 Test Organization

```
tests/
├── conftest.py                 # Shared fixtures
├── test_frontmatter_parsing.py # parse_frontmatter, scan_docs
├── test_cycle_detection.py     # Cycles, broken links
├── test_orphan_detection.py    # Orphans, type hierarchy, depth
├── test_migrate_frontmatter.py # Migration script functions
└── test_yaml_edge_cases.py     # Null handling, normalization
```

### 10.2 Key Fixtures

| Fixture | Purpose |
|---------|---------|
| `temp_docs_dir` | Temporary directory for test files |
| `valid_kernel_doc` | Document with complete frontmatter |
| `circular_docs` | Two documents referencing each other |
| `broken_link_doc` | Document referencing nonexistent ID |
| `architecture_violation_docs` | Kernel depending on atom |

### 10.3 Running Tests

```bash
# Run all tests
pytest tests/ -v

# Run with coverage
pytest tests/ -v --cov=.ontos/scripts --cov-report=xml

# Run specific test file
pytest tests/test_yaml_edge_cases.py -v
```

---

## 11. Extension Points

### 11.1 Custom Skip Patterns

Add patterns to `ontos_config.py`:

```python
SKIP_PATTERNS = DEFAULT_SKIP_PATTERNS + ['drafts/', 'archive/', 'WIP_']
```

### 11.2 Custom Allowed Orphan Types

Allow additional types to be orphans:

```python
ALLOWED_ORPHAN_TYPES = DEFAULT_ALLOWED_ORPHAN_TYPES + ['reference']
```

### 11.3 Multiple Documentation Directories

Scan multiple directories:

```bash
python3 ontos_generate_context_map.py --dir docs --dir specs --dir wiki
```

### 11.4 Increased Dependency Depth

For complex projects:

```python
MAX_DEPENDENCY_DEPTH = 8
```

---

## 12. Security Considerations

### 12.1 YAML Safety

All YAML parsing uses `safe_load()` to prevent code execution:

```python
frontmatter = yaml.safe_load(parts[1])  # Never yaml.load()
```

### 12.2 File Path Handling

Scripts operate only within configured directories. No shell injection protection is provided for untrusted input—Ontos assumes trusted local execution.

### 12.3 Network Access

Only `ontos_update.py` makes network requests (git clone). All other scripts are fully offline.

---

## 13. Performance Characteristics

| Operation | Complexity | Typical Time (100 docs) |
|-----------|------------|-------------------------|
| Full scan | O(n) files | < 500ms |
| Cycle detection | O(V + E) | < 100ms |
| Depth calculation | O(V + E) with memo | < 50ms |
| Context map generation | O(n log n) for sorting | < 1s total |

For projects with 1000+ documents, consider:
- Increasing `SKIP_PATTERNS` to exclude generated files
- Using `--dir` to scan only relevant subdirectories

---

## 14. Version History

| Version | Date | Notable Changes |
|---------|------|-----------------|
| 1.4.0 | 2025-12-10 | Added git hooks installation, hook updates via `ontos_update.py` |
| 1.3.0 | 2025-12-10 | Excluded `Ontos_*.md` files from project context maps |
| 1.0.0 | 2025-12-10 | First stable release: update script, split config, maintenance guide |
| 0.4.0 | 2025-11-29 | Centralized config, `--strict` mode, test suite, watch mode |
| 0.3.0 | 2025-11-24 | Strict mode for CI/CD, session archival, five integrity checks |
| 0.2.0 | 2025-11-23 | Type hierarchy validation, cycle detection |
| 0.1.0 | 2025-11-22 | Initial release: frontmatter spec, context map generation |

See `Ontos_CHANGELOG.md` for complete details.

---

*This document describes the technical implementation of Project Ontos v1.0. It should be updated when architectural changes are made, not for configuration or documentation updates.*
